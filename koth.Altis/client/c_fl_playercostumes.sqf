/*
	ArmA 3 King of Hill
	Code written by Sa-Matra
	Using this code without Sa-Matra's direct permission is forbidden
	
	Special build for Gamed.de
	
	Build ETYKMBSIGDHGNALL
*/
#include "hpp\idcs.hpp"
#include "hpp\defines.hpp"
kgdqcx={[player,call kg2ag7]call kg8d8a;};kg8d8a={private["_05b","_09d","_id","_0ae","_0ie","_0de","_0ee","_0ge"];_05b=_this select 0;_09d=_this select 1;_id=_09d call kgew1m;_0ae=database_loadout_costumesList select _id select 7;if(!local _05b)exitWith{systemChat "Unit is not local!"};removeUniform _05b;removeVest _05b;removeBackpack _05b;removeHeadgear _05b;removeGoggles _05b;private _0be=(_0ae select 0);if!(_0be isEqualType "")then{_0be=call _0be;};if(_0be!="")then{removeUniform _05b;_05b forceAddUniform _0be;};private _0ce=(_0ae select 1);if!(_0ce isEqualType "")then{_0ce=call _0ce;};if(_0ce!="")then{_05b addVest _0ce;};_0de=(_0ae select 2);_0ee=(_0ae select 7);if!(_0de isEqualType "")then{_0de=call _0de;};if!(_0ee isEqualType "")then{_0ee=call _0ee;};_0fe=call kg5k7f;_0ge=call kg3g1m;if(_0ee=="")then{_0ee="B_Carryall_Base"};if(_0de=="")then{_0de=_0ee};if(switch(true)do{case(_0ge==3):{_05b addBackpack _0fe;true};case(_0ge==2):{_05b addBackpack _0ee;true};case(_0ge==1||(_0ae select 3)):{_05b addBackpack _0de;true};default{false};})then{private["_0he"];_0he=unitBackpack _05b;clearWeaponCargoGlobal _0he;clearMagazineCargoGlobal _0he;clearItemCargoGlobal _0he;};_0ie=(_0ae select 4);if!(_0ie isEqualType "")then{_0ie=call _0ie};if(_0ie!="")then{_05b addHeadgear _0ie;};if!(call kgyb9y)then{_0je=(_0ae select 5);if!(_0je isEqualType "")then{_0je=call _0je};if(_0je!="")then{_05b addGoggles _0je;};if(typeName(_0ae select 6)==typeName[])then{if(kg352w!=""&&!(kg352w in(_0ae select 6)))then{_05b addGoggles kg352w;};};};call kglj4j;};kglj4j={player setAnimSpeedCoef(database_loadout_costumesList select(call kg2ag7 call kgew1m)select 8);};kg5k7f={switch(side group player)do{case blufor:{"B_Bergen_mcamo_F"};case opfor:{"B_Bergen_hex_F"};case independent:{"B_Bergen_dgtl_F"};default{"B_Bergen_mcamo_F"};};};kgejuq={private["_09d","_0ae","_0be","_0ce","_0de","_0ee"];_09d=call kg2ag7;_0ae=database_loadout_costumesList select(_09d call kgew1m)select 7;_0be=(_0ae select 0);_0ce=(_0ae select 1);_0de=(_0ae select 2);_0ee=(_0ae select 7);_0fe=call kg5k7f;if!(_0be isEqualType "")then{_0be=call _0be;};if!(_0ce isEqualType "")then{_0ce=call _0ce;};if!(_0de isEqualType "")then{_0de=call _0de;};if!(_0ee isEqualType "")then{_0ee=call _0ee;};if(_0ee=="")then{_0ee="B_Carryall_Base"};if(_0de=="")then{_0de=_0ee};[(if(_0be=="")then{0}else{getNumber(configFile>>"CfgVehicles">>getText(configFile>>"CfgWeapons">>_0be>>"ItemInfo">>"containerclass")>>"maximumload")}),(if(_0ce=="")then{0}else{getNumber(configFile>>"CfgVehicles">>getText(configFile>>"CfgWeapons">>_0ce>>"ItemInfo">>"containerclass")>>"maximumload")}),getNumber(configFile>>"CfgVehicles">>_0de>>"maximumload"),getNumber(configFile>>"CfgVehicles">>_0ee>>"maximumload"),getNumber(configFile>>"CfgVehicles">>_0fe>>"maximumload")]};kg2nt4={private["_0ke","_0le"];_0ke=call kg2ag7;_0le=({database_loadout_costumesList select _x select 0==_0ke}count(playerSide call kgriks))!=0;if(!_0le)then{call kgfjf3;};_0le};kgfjf3={private["_0me","_0ne","_0na"];_0me=(if(typeName _this==typeName blufor)then{_this}else{playerSide});_0ne=_0me call kgriks;_0na=(if(count(_0ne)==0)then{private["_0oe"];_0oe=0;for "_i" from 0 to count(database_loadout_costumesList)-1 do{if(call(database_loadout_costumesList select _i select 4)&&_0me in(database_loadout_costumesList select _i select 5))exitWith{_0oe=_i;};};database_loadout_costumesList select _0oe select 0;}else{database_loadout_costumesList select(_0ne select 0)select 0;});kglhhp set[[blufor,opfor,independent]find _0me,_0na];};kgriks={private["_0ba"];_0ba=[];for "_i" from 0 to count(database_loadout_costumesList)-1 do{if(call(database_loadout_costumesList select _i select 4))then{if(_this in(database_loadout_costumesList select _i select 5))then{if(kgsoxm>=call(database_loadout_costumesList select _i select 2))then{private["_0pe"];_0pe={if(kgge9y find _x==-1)exitWith{_x}}forEach((database_loadout_costumesList select _i select 3)+[-1]);if(_0pe==-1)then{_0ba set[count _0ba,_i];};};};};};_0ba};kg2ag7={if(typeName kglhhp!=typeName[])then{kglhhp=[];};if(count(kglhhp)!=3)then{kglhhp=["","",""];};kglhhp select([blufor,opfor,independent]find playerSide);};kgew1m={private["_0ba"];_0ba=-1;for "_i" from 0 to count(database_loadout_costumesList)-1 do{if(database_loadout_costumesList select _i select 0==_this)exitWith{_0ba=_i;};};_0ba};kgnvgu=[kgvdqv,kgi5gu,kgu38p,kgg4lj,kga54u,kgd6pm];kg69n9={disableSerialization;private["_0a"];_0a=_this;[_0a,""]call bis_fnc_guiEffectTiles;(_0a displayCtrl kgkbli)ctrlShow false;(_0a displayCtrl kgwcj6)ctrlSetText kgfmtd;(_0a displayCtrl kgwcj6)ctrlShow!isStreamFriendlyUIEnabled;kgci7m=[];for "_i" from 0 to count(kgnvgu)-1 do{kgci7m set[_i,ctrlPosition(_0a displayCtrl(kgnvgu select _i))];};kg4p5v=[(profilenamespace getvariable["GUI_BCG_RGB_R",0.3843]),(profilenamespace getvariable["GUI_BCG_RGB_G",0.7019]),(profilenamespace getvariable["GUI_BCG_RGB_B",0.8862]),1];kgkh2c=call kg2ag7;call kg2h8d;};kgg8yf={if(kgkh2c!=call kg2ag7)then{call kg2nt4;call kgdqcx;call kgfx6i;};};kg2h8d={disableSerialization;private["_0a","_0ne","_0qe","_0re"];_0a=uiNamespace getVariable "KingOfHill_Costumes";(_0a displayCtrl kgkbli)ctrlShow true;_0ne=[];for "_i" from 0 to count(database_loadout_costumesList)-1 do{if(call(database_loadout_costumesList select _i select 4))then{if(playerSide in(database_loadout_costumesList select _i select 5))then{private["_0pe","_0g"];_0pe={if(kgge9y find _x==-1)exitWith{_x}}forEach((database_loadout_costumesList select _i select 3)+[-1]);_0g=call(database_loadout_costumesList select _i select 2);_0ne set[count _0ne,[_i,(switch(true)do{case(_0pe!=-1):{format["""%1""<br/>REQUIRED",database_loadout_perksList select(database_loadout_perksIndexes find _0pe)select 4]};case(kgsoxm<_0g):{format["需要达到 %1 级",_0g]};default{""};})]];};};};_0qe=call kg2ag7;_0re=(kgci7m select(kgnvgu find kgd6pm)select 2)-(SafeZoneW/(getResolution select 2))*2;for "_i" from 0 to 99 do{private["_0se","_0lb","_0te","_02c","_0ue","_0ve","_0we"];_0se=_0a displayCtrl(kgvdqv+_i);_0lb=_0a displayCtrl(kgi5gu+_i);_0te=_0a displayCtrl(kgu38p+_i);_02c=_0a displayCtrl(kgg4lj+_i);_0ue=_0a displayCtrl(kga54u+_i);_0ve=_0a displayCtrl(kgd6pm+_i);_0we=[_0se,_0lb,_0te,_02c,_0ue,_0ve];if(_i<count(_0ne))then{for "_j" from 0 to count(_0we)do{private["_pos"];_pos=+kgci7m select _j;_pos set[0,(_pos select 0)+_0re*_i];(_0we select _j)ctrlSetPosition _pos;(_0we select _j)ctrlCommit 0;};private["_id","_0xe"];_id=(_0ne select _i select 0);_0xe=(_0ne select _i select 1);_09d=database_loadout_costumesList select _id;_0se ctrlSetText(_09d select 1);_0ue ctrlSetText(_09d select 6);_0lb ctrlShow false;if(_0xe=="")then{_0ve ctrlShow false;if(_09d select 0==_0qe)then{kg4uev=_i;_0te ctrlShow false;_02c ctrlShow true;}else{_0te ctrlShow true;_02c ctrlShow false;};_0ye=[];_0ze=[];{_x params["_0ec","_03e","_02e"];if!(_0ec isEqualType "")then{_0ec=call _0ec;};{if(getText(_x>>"depends")==""&&getNumber(_x>>"armor")>0)then{_01e=toLower(_x call _02e);_0c=_0ye find _01e;if(_0c<0)then{_0c=_0ye pushBack _01e;_0ze pushBack 0;};_0ze set[_0c,(_0ze select _0c)+getNumber(_x>>"armor")];};}forEach configProperties[_0ec call _03e,"true"];}forEach[[_09d select 7 select 4,{configFile>>"CfgWeapons">>_this>>"ItemInfo">>"HitpointsProtectionInfo"},{getText(_this>>"hitpointName")}],[_09d select 7 select 1,{configFile>>"CfgWeapons">>_this>>"ItemInfo">>"HitpointsProtectionInfo"},{getText(_this>>"hitpointName")}],[_09d select 7 select 0,{configFile>>"CfgVehicles">>getText(configFile>>"CfgWeapons">>_this>>"ItemInfo">>"uniformClass")>>"HitPoints"},{configName _this}]];_04e=[];{_0c=_0ye find toLower(_x select 0);if(_0c>=0)then{if(_0ze select _0c>1)then{_04e pushBack format["%1: %2",_x select 1,_0ze select _0c];};};}forEach[["HitHead",localize "STR_KOH_Costumes_HitHead"],["HitFace",localize "STR_KOH_Costumes_HitFace"],["HitNeck",localize "STR_KOH_Costumes_HitNeck"],["HitChest",localize "STR_KOH_Costumes_HitChest"],["HitBody",localize "STR_KOH_Costumes_HitBody"],["HitAbdomen",localize "STR_KOH_Costumes_HitAbdomen"],["HitDiaphragm",localize "STR_KOH_Costumes_HitDiaphragm"],["HitPelvis",localize "STR_KOH_Costumes_HitPelvis"],["HitArms",localize "STR_KOH_Costumes_HitArms"],["HitHands",localize "STR_KOH_Costumes_HitHands"],["HitLegs",localize "STR_KOH_Costumes_HitLegs"]];_05e=round(((_09d select 8)-1)*100);_0ue ctrlSetTooltip([(if(count _04e>0)then{localize "STR_KOH_Costumes_TooltipArmorRates"+"\n"+(_04e joinString "\n")}else{localize "STR_KOH_Costumes_TooltipNoArmor"}),(if(_05e!=0)then{localize "STR_KOH_Costumes_TooltipSpeed"+": "+(if(_05e>0)then{"+"}else{""})+str _05e+"%"}else{""})]joinString "\n");}else{_0te ctrlShow false;_02c ctrlShow false;_0ve ctrlSetStructuredText parseText format["<br/><br/><br/><br/><br/>%1",_0xe];};}else{{_x ctrlSetPosition[0,0,-0.1,-0.1];_x ctrlCommit 0;_x ctrlShow false;}forEach _0we;};};kg7em6=_0ne;};kg4f7w={disableSerialization;private["_0a","_id"];_0a=uiNamespace getVariable "KingOfHill_Costumes";_id=(kg7em6 select _this select 0);(_0a displayCtrl(kgu38p+kg4uev))ctrlShow true;(_0a displayCtrl(kgg4lj+kg4uev))ctrlShow false;(_0a displayCtrl(kgu38p+_this))ctrlShow false;(_0a displayCtrl(kgg4lj+_this))ctrlShow true;kg4uev=_this;kglhhp set[[blufor,opfor,independent]find playerSide,database_loadout_costumesList select _id select 0];};