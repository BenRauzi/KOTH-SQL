/*
	ArmA 3 King of Hill
	Code written by Sa-Matra
	Using this code without Sa-Matra's direct permission is forbidden
	
	Special build for Gamed.de
	
	Build ETYKMBSIGDHGNALL
*/
#include "hpp\idcs.hpp"
#include "hpp\defines.hpp"
#define kgfr5n	(call kg1714)
kge94l=compileFinal "
	(serverCommandAvailable ""#kick"") || call kgqx21 || call kg1714
";kg1714=compileFinal "
	kguvm4 in [
		 ""76561198361632064""
		,""76561198446291075""
        ,""76561198882291522""
		,""76561198418378365""
		,""76561198431036461""
	]
";kgqx21=compileFinal "
	(kguvm4 in (call settings_trustedUIDs))
";kgc5v1={if(!call kge94l)exitWith{};createDialog "KingOfHill_AdminMenu";};kgsx2k={if(!call kge94l)exitWith{};disableSerialization;private["_0a","_0b"];_0a=_this;[_0a,""]call bis_fnc_guiEffectTiles;(_0a displayCtrl kg21kj)ctrlSetText kgfmtd;(_0a displayCtrl kg21kj)ctrlShow!isStreamFriendlyUIEnabled;kg9ggn=-1;kg4rox="";kgsprg="";kgpc8c=[];{(_0a displayCtrl(_x select 2))ctrlShow false;}forEach kgaj1k;_0b=_0a displayCtrl kgtbo9;for "_i" from 0 to count(kgaj1k)-1 do{if(call(kgaj1k select _i select 1))then{_0c=_0b lbAdd(kgaj1k select _i select 0);_0b lbSetData[_0c,str(_i)];};};_0b lbSetCurSel 0;0 call kg36w2;};kg1tcl={};kgvc43={disableSerialization;private["_0a","_0b"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};_0b=_0a displayCtrl kgtbo9;parseNumber(_0b lbData(lbCurSel _0b))call kg36w2;};kg36w2={disableSerialization;private["_0a","_0d"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};if(_this<0)exitWith{};if(kg9ggn>=0&&kg9ggn!=_this)then{(_0a displayCtrl(kgaj1k select kg9ggn select 2))ctrlShow false;};kg9ggn=_this;_0d=_0a displayCtrl kgvkhi;_0d ctrlSetText format["Selected function: %1",kgaj1k select _this select 0];call(kgaj1k select _this select 3);};kgyqv2={disableSerialization;private["_0a","_0d"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};};kgbwid={copyToClipboard _this;kg4rox=_this;hint format["Copied to clipboard:\n\n%1",_this];};kg42cv={disableSerialization;private["_0a"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};(_0a displayCtrl kgak8w)ctrlShow true;call kg6rzu;};kg6rzu={disableSerialization;private["_0a","_0e"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};_0e=_0a displayCtrl kg35wy;_0e lnbsetColumnsPos[0,-0.01,0.03,0.45,0.75];lnbClear _0e;kg6w7r=[];{kg6w7r set[count kg6w7r,[_x,name _x,vehicle _x,getPlayerUID(_x),side _x]];}forEach playableUnits;{_0f=(if((_x select 0)==(_x select 2))then{"-"}else{getText(configFile>>"CfgVehicles">>typeOf(_x select 2)>>"displayName")});_0g=(_x select 0)getVariable["koh_level",0];_0h=switch(true)do{case(_0g<10):{" "};default{""};};_0c=_0e lnbAddRow["",_0h+(if(_0g==0)then{""}else{str _0g}),_x select 1,_0f,_x select 3];_0e lnbSetPicture[[_0c,0],(switch(_x select 4)do{case blufor:{"A3\ui_f\data\map\diary\icons\playerWest_ca.paa"};case opfor:{"A3\ui_f\data\map\diary\icons\playerEast_ca.paa"};case independent:{"A3\ui_f\data\map\diary\icons\playerGuer_ca.paa"};default{"A3\ui_f\data\map\diary\icons\playerCiv_ca.paa"};})];if((_x select 0)!=(_x select 2))then{_0e lnbSetPicture[[_0c,3],getText(configFile>>"CfgVehicles">>typeOf(_x select 2)>>"icon")];};}forEach kg6w7r;};kgadg8={disableSerialization;private["_0a","_0e","_0i"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};_0e=_0a displayCtrl kg35wy;_0i=lnbCurSelRow _0e;if(_0i<0||_0i>=count(kg6w7r))exitWith{};switch(_this)do{case 0:{(kg6w7r select _0i select 3)call kgbwid;};case 1:{(kg6w7r select _0i select 1)call kgbwid;};case 2:{_0j=format["%1, %2",(kg6w7r select _0i select 1),(kg6w7r select _0i select 3)];_0j call kgbwid;};};};kgyys6={disableSerialization;private["_0a","_0e","_0i"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};_0e=_0a displayCtrl kg35wy;_0i=lnbCurSelRow _0e;if(_0i<0)exitWith{};_uid=(kg6w7r select _0i select 3);_uid call kgs7af;};kgm2hd={disableSerialization;private["_0a","_0e","_0i"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};_0e=_0a displayCtrl kg35wy;_0i=lnbCurSelRow _0e;if(_0i<0)exitWith{};_uid=(kg6w7r select _0i select 3);_uid call kgcduv;};kgnucf={disableSerialization;private["_0a"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};(_0a displayCtrl kg3i2d)ctrlShow true;(_0a displayCtrl kgvfhj)ctrlSetText kg4rox;call kgi73q;};kgi73q={disableSerialization;private["_0a"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};(_0a displayCtrl kgd9m2)ctrlSetText format["Teamswitch restrictions array consists of %1 elements.",count(kgxq4m)];};kgarij={true spawn{disableSerialization;private["_0a","_0k","_uid","_0c"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};_0k=_0a displayCtrl kgvfhj;_uid=ctrlText _0k;_0c=-1;for "_i" from 0 to count(kgxq4m)-1 do{if((kgxq4m select _i select 0)==_uid)exitWith{_0c=_i;};};if(_0c==-1)exitWith{["UID not found in team switchers list","Team switchers",true]call BIS_fnc_GUImessage;};kgxq4m=[kgxq4m,_0c]call BIS_fnc_removeIndex;publicVariable "kgxq4m";["UID succesfully removed from the list","Team switchers",true]call BIS_fnc_GUImessage;call kgi73q;};};kgjmtx={true spawn{if(["Are you sure you want to remove team switch restrictions from all players that were on the server?","Team switchers",true,true]call BIS_fnc_GUImessage)then{kgxq4m=[];publicVariable "kgxq4m";["Team switchers array is now empty","Team switchers",true]call BIS_fnc_GUImessage;};call kgi73q;};};kg1deo={disableSerialization;private["_0a"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};(_0a displayCtrl kgfm6k)ctrlShow true;(_0a displayCtrl kg2wvk)ctrlSetText kg4rox;call kgdzxl;};kgdzxl={disableSerialization;private["_0a"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};(_0a displayCtrl kglbii)ctrlSetText format["Teamkillers array consists of %1 players.",count(kgq1v5)];};kgjcbe={true spawn{disableSerialization;private["_0a","_0k","_uid","_0c"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};_0k=_0a displayCtrl kg2wvk;_uid=ctrlText _0k;_0c=-1;for "_i" from 0 to count(kgq1v5)-1 do{if((kgq1v5 select _i select 0)==_uid)exitWith{_0c=_i;};};if(_0c==-1)exitWith{["UID not found in teamkillers list","Teamkillers",true]call BIS_fnc_GUImessage;};kgq1v5=[kgq1v5,_0c]call BIS_fnc_removeIndex;publicVariable "kgq1v5";["UID succesfully removed from teamkillers list","Teamkillers",true]call BIS_fnc_GUImessage;call kgdzxl;};};kg616j={true spawn{if(["Are you sure you want to remove all recorded teamkills?","Teamkillers",true,true]call BIS_fnc_GUImessage)then{kgq1v5=[];publicVariable "kgq1v5";["All teamkills have been removed","Teamkillers",true]call BIS_fnc_GUImessage;}call kgdzxl;};};kghue9={disableSerialization;private["_0a"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};(_0a displayCtrl kgnuqg)ctrlShow true;(_0a displayCtrl kgiu56)ctrlSetText kg4rox;call kga8a5;};kga8a5={disableSerialization;private["_0a","_0l"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};_0l=_0a displayCtrl kgvo9t;lbClear _0l;{_0l lbAdd _x;}forEach(kgjx1m);};kggti4={true spawn{disableSerialization;private["_0a","_0k","_uid"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};_0k=_0a displayCtrl kgiu56;_uid=ctrlText _0k;if!(_uid in kgjx1m)then{_0m=objNull;_0n=true;{if(getPlayerUID(_x)==_uid)exitWith{_0m=_x};}forEach playableUnits;if(!isNull(_0m))then{_0n=[format["Player %1 (%2) is currently in the game, are you sure you want to remove him?",name _0m,_uid],"Remove players",true,true]call BIS_fnc_GUImessage;};if(_0n)then{kgjx1m set[count kgjx1m,_uid];publicVariable "kgjx1m";call kga8a5;};};};};kg5nnq={disableSerialization;private["_0a","_0l","_0i","_uid"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};_0l=_0a displayCtrl kgvo9t;_0i=lbCurSel _0l;if(_0i<0||_0i>=count(kgjx1m))exitWith{};_uid=_0l lbText _0i;if(_uid in kgjx1m)then{kgjx1m=kgjx1m-[_uid];publicVariable "kgjx1m";call kga8a5;};};kgbgiy={disableSerialization;private["_0a"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};(_0a displayCtrl kgwvtq)ctrlShow true;};kgcduv={call kgibdh;kg9d82=_this;kg55bi={call kgbikf}call kgisti;kg1e1d=(findDisplay 46)displayAddEventHandler["KeyDown",{if(_this select 1==1)then{call kgibdh;true;}else{false};}];kgkwxi=[player,kg9d82];publicVariableServer "kgkwxi";};kgibdh={if(!isNil "kg55bi")then{deleteVehicle kg55bi;};if(!isNil "kg1e1d")then{(findDisplay 46)displayRemoveEventHandler["KeyDown",kg1e1d];};kg9d82="";if(cameraOn!=player&&cameraOn!=vehicle player)then{player switchCamera "INTERNAL";};};kgbikf={if(kg9d82=="")exitWith{call kgibdh;deleteVehicle thisTrigger;};_target={if(getPlayerUID _x==kg9d82)exitWith{_x};}forEach allPlayers;if(_target==player)exitWith{call kgibdh;};_0o={if(_x getVariable["revive_player",objNull]==_target)exitWith{_x};}forEach kgonou;if(!isNil "_0o")then{_target=_0o;};if(!isNil "_target")then{_target=vehicle _target;if(cameraOn!=_target)then{_target switchCamera "EXTERNAL";};};};kgo87w={kg12ki=player;publicVariableServer "kg12ki";hint "Click on map to aim sattelite";onMapSingleClick "[_pos] call c_proving_ground_fnc_sattelite;onMapSingleClick '';";openMap true;closeDialog 0;true spawn{sleep 0.01;closeDialog 0;sleep 0.01;closeDialog 0;};};kgs7af={if!(kgfr5n)exitWith{};disableSerialization;private["_0a"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};(_0a displayCtrl(kgaj1k select kg9ggn select 2))ctrlShow false;kg9ggn=5;(_0a displayCtrl kgrpnq)ctrlShow true;true call kgxt3h;kgsprg=_this;kgsprg call kg9yut;};kg9yut={kgck1j=[kguvm4,_this];publicVariableServer "kgck1j";true call kgxt3h;};kgxt3h={if!(kgfr5n)exitWith{};disableSerialization;private["_0a","_0p"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};_0p=_0a displayCtrl kg8fn8;_0p ctrlShow _this;};kgsijy={kgpc8c=_this;false call kgxt3h;_this call kghrey;};kghrey={disableSerialization;private["_0a","_0p","_0s","_0u","_0q","_0r"];_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};params["_0u","_name","_0t","_uid"];_0q=call kgbbnd;_0r="<br/>";_0s="";_0s=_0s+format["Name: %1",_name]+_0r;_0s=_0s+format["Steam name: %1",_0t]+_0r;_0s=_0s+format["<t color='#7777ff'><a href='https://steamcommunity.com/profiles/%1'>Steam%2profile</a></t>",_uid,toString[160]]+_0r;_0s=_0s+format["Level: %1, Perks: %2, Perk slots: %3/%4",_0u select 0,(_0u select 4)call kgiwqi,count(_0u select 4),(_0u select 3)]+_0r;_0s=_0s+format["XP: %1, XP Next: %2, XP Total: %3",(_0u select 1)call kgkzn8,(_0u select 2)call kgkzn8,(_0u select 10)call kgkzn8]+_0r;_0s=_0s+format["Money: %1, Money total: %2",(_0u select 5)call kgkzn8,(_0u select 11)call kgkzn8]+_0r+_0r;_0s=_0s+format["Unlocked primary: %1",_0u select 6]+_0r+_0r;_0s=_0s+format["Unlocked scopes: %1",_0u select 7]+_0r+_0r;_0s=_0s+format["Unlocked secondary: %1",_0u select 8]+_0r+_0r;_0s=_0s+format["Unlocked handguns: %1",_0u select 9]+_0r+_0r;if(_0q!="KOTH1")then{_0s=_0s+format["Total play time: %1",(_0u select 12)call kgug1l];};_0p=_0a displayCtrl kg9y89;_0p ctrlSetStructuredText parseText _0s;_pos=ctrlPosition _0p;_pos set[3,(ctrlTextHeight _0p)];_0p ctrlSetPosition _pos;_0p ctrlCommit 0;};kgqhwq={_0a=uiNamespace getVariable "KingOfHill_AdminMenu";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};_0u=ctrlText(_0a displayCtrl kgisa4);call{if({toLower _0u find toLower _x>=0}count["compile","{","}","execVM","toString","loadFile"]>0)exitWith{};_0v=call compile _0u;if(isNil "_0v")exitWith{};if!(_0v isEqualType[])exitWith{};kgel64=[kguvm4,kgsprg,_0v];publicVariableServer "kgel64";};(_0a displayCtrl kgisa4)ctrlSetText "";};kgry5r={if(kguvm4==_this)then{kgug3b=_this;publicVariableServer "kgug3b";};};kgaj1k=[["Players list",{true},kgak8w,kg42cv],["Team switchers",{false},kg3i2d,kgnucf],["Teamkillers",{false},kgfm6k,kg1deo],["Remove players",{true},kgnuqg,kghue9],["Spectating",{true},kgwvtq,kgbgiy],["Profile",{false},kgrpnq,kgs7af]];"kgbrqb" addPublicVariableEventHandler{(_this select 1)call kgsijy;};"kguaok" addPublicVariableEventHandler{(_this select 1)call kgry5r;};