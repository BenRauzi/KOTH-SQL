/*
	ArmA 3 King of Hill
	Code written by Sa-Matra
	Using this code without Sa-Matra's direct permission is forbidden
	
	Special build for Gamed.de
	
	Build ETYKMBSIGDHGNALL
*/
#include "hpp\idcs.hpp"
#include "hpp\defines.hpp"
kg1f2s={_0ba=false;{if((_x distance(_this select 0))<(_this select 1))exitWith{_0ba=true;};}forEach playableUnits;_0ba};kgktel={{(_x distance(_this select 0))<(_this select 1)}count playableUnits};kgkzn8={if(_this==0)exitWith{"0"};private["_0ca","_0s","_0da"];_0ca=_this;_0s="";_0da=(if(_0ca>0)then{""}else{"-"});_0ca=abs(_0ca);while{_0ca>0}do{private["_0ea"];_0ea=floor(_0ca/10);_0s=str(_0ca-_0ea*10)+_0s;_0ca=_0ea;};(_0da+_0s)};kgsxrb={private "_0fa";_0fa=kgpj8x select([blufor,opfor,independent,civilian]find playerSide);_0fa globalChat _this;};kgveuw={if(player getVariable["koh_safe",-1]>0)exitWith{["注意","不能在基地里打开装备栏！",false,5]call kgumf6;true;};if({getNumber(configFile>>"CfgVehicles">>typeOf _x>>"isGround")==0&&getNumber(configFile>>"CfgVehicles">>typeOf _x>>"isBackpack")==0&&alive _x}count(_this select[1,2]select{!isNull _x})>0)exitWith{["注意","不能打开此载具的库存！",false,5]call kgumf6;true;};false;};kgyzs8={if(isNil{kga2iy})then{kga2iy=_this select 0;kggexj=_this select 1;kgjod5=_this select 2;kgvajz=0;kg7kbc=diag_tickTime+kggexj;kgtvdr=0.001;1 preloadObject player;};};kg93kv={kga2iy=nil;endLoadingScreen;};kgisti={_this=toArray(format["%1",_this]);_this set[0,32];_this set[count _this-1,32];_this=toString _this;private "_0ga";_0ga="EmptyDetector" createVehicleLocal[0,0,0];_0ga setTriggerArea[0,0,0,false];_0ga setTriggerStatements[_this,"",""];_0ga};kghftm={kgyecs=0;kgdjwj=0;kgeqti="";kgmwcb=objNull;kgwsg1=objNull;kg61p9=0;kgb64s=false;kgk9s3=[];kgp1mk=[];kg5jlj=[];kgjz6p=false;kgqa6p=0;kgg5fy=0;kgh6jy=objNull;kgs36x=0;kgkiui=0;kg31on=[];kgxu55=[];kga2iy=nil;kggexj=0;kg7kbc=0;kgjod5={};kgvajz=0;kgtvdr=0;kgnvgi=0;kgzxw1=false;kgy5ql=0;kg24rd=0;kg1v7y=0;kg96qo=0;kgstsa=0;kgguzn=0;kgkqcy="";kg3oa3=objNull;kgil56=false;kg6wpx=0;kgbepj=false;kgci4x=objNull;kgj4dd=false;kg949t=0;kgnhig=0;kg4zpo=[];kg3xkp=0;uiNamespace setVariable["client_createMarkerDisplay",displayNull];kgd1cx=0;kg88rm=false;kg5ky3=false;kgy1pz=false;kgle6q=0;{call kgthk6}call kgisti;};kgthk6={kgb64s=false;if(!kgj4dd)then{_0ha=(if(isServer)then{52}else{53});if(getClientState=="BRIEFING SHOWN")then{if(!isNull(findDisplay _0ha))then{ctrlActivate((findDisplay _0ha)displayCtrl 1);kgj4dd=true;};};if(getClientState=="BRIEFING READ")then{kgj4dd=true;};};if(player!=player)exitWith{};if(isNil{kg6wp3})exitWith{};if(!kguzdi)then{if(isNil "kguvm4")exitWith{};if(isNil "kghkch")exitWith{kghkch=kguvm4;publicVariableServer "kghkch";kgzrlh=diag_tickTime+3;};if(isNil "kg8o72"&&diag_tickTime<kgzrlh)exitWith{};if(!isNil "kg8o72"&&call kgluw1&&{kg8o72}&&true)then{if!(profileNamespace getVariable["koh_reset",false])then{call kghvkk;[format[localize "STR_KOH_UnbanReset","<a href='https://discord.gg/0bKRdNI8dtpQludc'>","</a>"],localize "STR_KOH_Gen_Warning",true]spawn BIS_fnc_GUImessage;};profileNamespace setVariable["koh_reset",true];saveProfilenamespace;};kguzdi=true;diag_log "Trying to load player profile now...";call kgk7mx;diag_log "Player profile setup done.";call kgxqcw;};if(kgmn4v)then{kgmn4v=false;if(diag_tickTime>(kga4bj+10))then{call kgttgb;};};if(diag_tickTime>(kg2xyw+30))then{if(diag_tickTime>(kga4bj+60))then{call kgttgb;};};if(getPlayerChannel player==0)then{setCurrentChannel 5;}else{if(getPlayerChannel player==1)then{if(kg1v7y==0)then{kg1v7y=diag_tickTime;};if(kg96qo!=0)then{kg96qo=0;};if((diag_tickTime-kg1v7y)>30)then{if(diag_tickTime>(kgguzn+10))then{kgstsa=kgstsa+1;kgguzn=diag_tickTime;[format["No voice spam in %1!",localize "str_channel_side"],format["You're talking too much in %1, please turn off your microphone or you'll be removed from the game. Press %2 if you have microphone constantly enabled in game.<br/><br/>Warning %3/3",localize "str_channel_side",actionKeysNames "VoiceOverNet",kgstsa],false,5]call kgumf6;};};}else{if(kg1v7y!=0)then{if(kg96qo==0)then{kg96qo=diag_tickTime;};if(diag_tickTime-kg96qo>1)then{kg1v7y=0;kg96qo=0;};};};};if(kgstsa>3)then{kgjx1m=kgjx1m+[kguvm4];publicVariable "kgjx1m";endMission "VONSpam";};if(!isNil{kgmadd})then{call kgrn2v;call kgspig;};if(missionNamespace getVariable["kgqyg5",kgrdur]!=missionNamespace getVariable["kgskxp",kgrdur])then{kgqyg5 call kgnwrv;};if(kgfcpm)then{kgfcpm=false;player action["SwitchWeapon",player,player,1234];player setDamage 0;call kg2nt4;call kgdqcx;call kgfx6i;};
#define kgc2af	(60 * 15)
#define kgopnr		(60 * 16)
if(!isServer&&(diag_tickTime>=kg2xyw+kgc2af))then{if!(kguvm4 in(call settings_trustedUIDs))then{["警告",format["你已经挂机15分钟，踢出倒计时：<br/><t size='2'>%1</t>",((kgopnr-(diag_tickTime-kg2xyw))max 0)call kgug1l],false,1]call kgumf6;if((diag_tickTime>=kg2xyw+kgopnr))then{endMission "LOSER";};};};switch(missionNamespace getVariable["kgskxp",kgrdur])do{case kg27tr:{if(time>0)then{if(player distance kg2e5i<40)then{{if(player knowsAbout _x==0)then{player reveal[_x,4];};}forEach kglc1q;};if(!kg4bsk&&!kgkyng)then{_0ia=getPosATL(vehicle player);_0ja=player getVariable["koh_safe",-1];if(_0ja>0)then{if(call{if(_0ja<serverTime)then{(_0ia select 2>kgo1qf)||!(_0ia in kgj6pi)}else{(_0ia select 2>kgrnud)||!((_0ia in kg7t24)||(_0ia in kgxuke))};})then{player setVariable["koh_safe",-1,true];if(vehicle player!=player&&effectiveCommander(vehicle player)==player)then{(vehicle player)setVariable["koh_safe",-1,true];};"你已离开安全区，无敌状态取消.请勿卡安全区!" call kgsxrb;};}else{if(_0ia select 2<kgrnud)then{if(_0ia in kg7t24||_0ia in kgxuke)then{if(_0ja<0)then{player setVariable["koh_safe",serverTime+kg2flx,true];if(vehicle player!=player&&effectiveCommander(vehicle player)==player)then{(vehicle player)setVariable["koh_safe",serverTime+kg2flx,true];};format["你已进入安全区，将在%1秒内无敌.请勿卡安全区!",kg2flx]call kgsxrb;};};};};};if(!isNull(findDisplay 602)&&!isServer)then{switch(true)do{case(player call kgjvx9):{(findDisplay 602)closeDisplay 1;["注意","不能在基地里打开装备栏！",false,5]call kgumf6;};case(!isNull(kgo7rz)):{if((kgo7rz isKindOf "AllVehicles")&&!(kgo7rz isKindOf "Man"))then{(findDisplay 602)closeDisplay 1;["注意","不能打开此载具的库存！",false,5]call kgumf6;};};};};if(diag_tickTime>kgnvgi)then{if(kgnvgi==0)then{kgnvgi=diag_tickTime;};kgnvgi=kgnvgi+1;if(!kg4bsk&&!kgkyng)then{kgv82e=kgv82e+1;};};};};case kgze3i:{if(!isNil{if(isNull(uiNamespace getVariable "KingOfHill_GameEnding"))then{nil}else{true}})then{disableSerialization;private["_0a","_0p"];_0a=uiNamespace getVariable "KingOfHill_GameEnding";_0p=_0a displayCtrl kgcnlu;_0ka=(kg2utt==playerSide);_0la=(switch(kg2utt)do{case blufor:{"蓝军"};case opfor:{"红军"};case independent:{"绿军"};});_0p ctrlSetStructuredText parseText format["<t color='%1' size='2'>%2</t><br/>%3获得了最终胜利！<br/><br/><t size='0.5'>%4 %5</t>",(if(_0ka)then{"#5555ff"}else{"#ee1111"}),(if(_0ka)then{"胜利！"}else{"失败"}),_0la,(if(isNil "kg8594")then{"下一局即将开始："}else{"服务器即将重启："}),((kg5km7-serverTime)max 0)call kgug1l];};if(serverTime>=kg5km7)then{15 cutFadeOut 0;call kgttgb;_0ka=(kg2utt==playerSide);if(_0ka)then{endMission "END1";}else{failMission "LOSER";};};kg4bsk=false;};};for "_i" from 0 to count(kg31on)-1 do{if(isNil{kgxu55 select _i})then{kgxu55 set[_i,diag_tickTime];};if(diag_tickTime>=(kgxu55 select _i))then{(kg31on select _i select 1)call(kg31on select _i select 0);kgxu55 set[_i,diag_tickTime+(kg31on select _i select 2)];};};if(true)then{_0ma=(getFatigue player-kgyecs);kgyecs=getFatigue player;if(_0ma<0)then{if((kgvxxv in kgge9y))then{_0na=kgyecs+(_0ma*database_loadout_indefatigablePerkMultiplier);kgyecs=_0na;player setFatigue _0na;};}else{kgyecs=kgyecs-_0ma/2;player setFatigue kgyecs;};};if(commandingMenu=="#WATCH")then{showCommandingMenu "";};if(animationState player!=kgeqti)then{kgeqti=animationState player;switch(getText(configFile>>"CfgMovesMaleSdr">>"States">>kgeqti>>"actions"))do{case "ParachuteFreeFall":{if(!kgjz6p)then{if(kgmwcb isKindOf "Air")then{_0oa=getPosATL player;_0pa=getPosATL kgmwcb;_0qa=((_0oa select 0)-(_0pa select 0))atan2((_0oa select 1)-(_0pa select 1));_0ra=5;_0sa=velocity player;player setVelocity[(_0sa select 0)+_0ra*(sin _0qa),(_0sa select 1)+_0ra*(cos _0qa),(_0sa select 2)-1];};kgjz6p=true;kgqa6p=serverTime;};};default{kgjz6p=false;};};};if(kgjz6p&&(serverTime>(kgqa6p+2))&&alive player&&(player distance kgmwcb)>6)then{_0ta=(if(surfaceIsWater(getPosATL player))then{getPosASL player}else{getPosATL player})select 2;if(_0ta<150+abs(velocity vehicle player select 2))then{kgjz6p=false;_0ua=createVehicle["Steerable_Parachute_F",getPosATL player,[],0,""];_0ua setPosATL getPosATL player;_0ua setDir getDir player;[_0ua,-90,0]call BIS_fnc_setPitchBank;kgg5fy=(velocity player)select 2;kgh6jy=_0ua;player action["SwitchWeapon",player,player,100];player switchcamera cameraView;player moveInDriver _0ua;};};if(kgg5fy<0)then{kgg5fy=kgg5fy+0.4;_0sa=velocity kgh6jy;_0sa set[2,kgg5fy];kgh6jy setVelocity _0sa;if(kgg5fy>-2)then{kgg5fy=0;};};if(vehicle player!=kgwsg1)then{kgmwcb=kgwsg1;kgwsg1=vehicle player;kgk9s3=(if(kgwsg1==player)then{[]}else{kgwsg1 call kgoqp4;});kgp1mk=kgwsg1 call kgzehu;kg5jlj=[];kguyfx=[];kg28ik=serverTime;kgd1cx=fuel kgwsg1;kg88rm=(kgwsg1 isKindOf "Plane");kgv74f=(typeOf(kgwsg1)=="Steerable_Parachute_F");if(isNil{kgwsg1 getVariable "koh_rolesarray"})then{kgv75b=kgwsg1 call kg7jca;kgwsg1 setVariable["kog_rolesarray",kgv75b];}else{kgv75b=kgwsg1 getVariable "koh_rolesarray";};if(kgwsg1!=player)then{if(typeOf(kgwsg1)!="Steerable_Parachute_F")then{if(kgwsg1 getVariable["koh_side",civilian]!=playerSide)then{kgwsg1 setVariable["koh_side",playerSide,true];};};_0ja=player getVariable["koh_safe",-1];if(player getVariable["koh_safe",-1]<0&&kgwsg1 getVariable["koh_safe",-1]>0)then{kgwsg1 setVariable["koh_safe",-1,true];if({isPlayer _x&&alive _x&&_x getVariable["koh_safe",-1]>0}count crew kgwsg1>0)then{kgfums=kgwsg1;publicVariable "kgfums";};};};kgzxw1=!isNil{kgwsg1 getHitPointDamage "HitHRotor"};if(kgzxw1)then{kgy5ql=kgwsg1 getHitPointDamage "HitHRotor";};call kgb9fq;};_0va=false;_0wa=kgwsg1 call kgm9on;if!(_0wa isEqualTo kg5jlj)then{_0va=true;kgzpwi=(if(kgwsg1==player||kgwsg1 in kgl5ya)then{false}else{_0xa=false;{if(_x)exitWith{_0xa=!(kgp1mk select _forEachIndex);};}forEach _0wa;_0xa});};kg5jlj=_0wa;_0ya=kgwsg1 call kgicd4;if(!_0va)then{_0va=!(_0ya isEqualTo kguyfx);};kguyfx=_0ya;if(_0va)then{if(call kgdfux)then{call kgs6zf;};};if(kgv74f)then{if(isTouchingGround kgwsg1)then{_0oa=getPosASL player;_0pa=+_0oa;_0pa set[2,(_0pa select 2)-1];_0za=(if(terrainIntersectASL[_0oa,_0pa])then{true}else{if(lineIntersects[_0oa,_0pa,player,kgwsg1])then{true}else{false}});if(_0za)then{_01a=0.4;kgwsg1 setVelocity[sin(getDir kgwsg1)*_01a,cos(getDir kgwsg1)*_01a,(velocity kgwsg1)select 2];if(kgkiui==0)then{kgkiui=diag_tickTime;}else{if(diag_tickTime>(kgkiui+1))then{deleteVehicle kgwsg1;};};};}else{kgkiui=0;};};if(!isNil{if(isNull(kgti9p))then{nil}else{true}})then{if(camCommitted kgti9p)then{call kg41pi;};};if(!isNil{kga2iy})then{switch(kgvajz)do{case 0:{if(!isNil{kg6wp3})then{kgvajz=1;startLoadingScreen[""];};};case 1:{private["_02a"];_02a=(1-((kg7kbc-diag_tickTime)/kggexj));if(preloadCamera kga2iy||diag_tickTime>=kg7kbc)then{kgvajz=2;};progressLoadingScreen _02a;};case 2:{kgtvdr=kgtvdr*1.1;private["_02a"];_02a=(1-((kg7kbc-diag_tickTime)/kggexj));_02a=1 min(_02a+kgtvdr);progressLoadingScreen _02a;if(_02a>=1)then{kga2iy=nil;call kgjod5;endLoadingScreen;};};};};if(kgzxw1)then{if(local kgwsg1)then{if((kgwsg1 getHitPointDamage "HitHRotor")!=kgy5ql)then{kgwsg1 setHitPointDamage["HitHRotor",kgy5ql];};};};if(kgl4pw)then{kgl4pw=false;if(kgwsg1!=player)then{_03a=isEngineOn kgwsg1;moveOut player;if(local kgwsg1)then{kgwsg1 engineOn _03a;};};};if(kgkqcy!=currentWeapon player)then{kgkqcy=currentWeapon player;kgbepj={if([kgkqcy,_x]call kg1gil)exitWith{1}}count["launch_Titan_short_base","launch_NLAW_F"]==1;};if(kgbepj)then{if((player ammo kgkqcy)>0)then{if(cursorTarget!=kg3oa3)then{kg3oa3=cursorTarget;kgil56={kg3oa3 isKindOf _x}count["Tank","Truck_F","Wheeled_APC_F","MRAP_01_base_F","MRAP_02_base_F","MRAP_03_base_F"]>0;};if(diag_tickTime>(kg6wpx+3))then{if(kgil56)then{if(count(crew kg3oa3)>0)then{if(kg3oa3 getVariable["koh_side",civilian]!=playerSide)then{kg6wpx=diag_tickTime;kgk9vp=kg3oa3;publicVariable "kgk9vp";};};};};};};if!(kgci4x isEqualTo laserTarget player)then{kgci4x=laserTarget player;kgci4x setVariable["koh_lased_by",player getVariable["koh_owner",-1],true];kg43v5=[kgci4x,side group player,toArray profileName];kg43v5 call kg83u4;publicVariable "kg43v5";};if(kg949t>0)then{if(diag_tickTime>kg949t&&diag_tickTime<kg949t+10)then{if({_x=="FirstAidKit"}count(items player)==(kg3xkp-1)&&damage(kg4zpo select 0)<kgnhig)then{_04a=(kg4zpo select 0);_04a setDamage 0;if(_04a!=player)then{if!(_04a call kgjvx9)then{if(_04a getVariable["koh_handleheal_reward_unit",objNull]!=_04a)then{_04a setVariable["koh_handleheal_reward_unit",_04a];[[-1,kgotel]]call kgt98j;};};};kg949t=0;};}else{kg949t=0;};};if(kga73j)then{kga73j=false;kgjjgd=allMissionObjects "SmokeShellVehicle";};if(count(kggmp7)>0)then{private "_05a";{if(!isNull(_x))then{if(diag_tickTime-(kga2nf select _forEachIndex)>1)then{_05a=_x;if({if(_x distance _05a<60)exitWith{1}}count kgjjgd>0)then{_06a=velocity _05a;_m=vectorMagnitude _06a;_06a set[2,(_06a select 2)-20*60/diag_fps];_06a vectorMultiply(_m/vectorMagnitude _06a);_05a setVelocity _06a;};};};}forEach kggmp7;};_07a=-1;for "_i" from 0 to count(kg9fav select 0)-1 do{_08a=kg9fav select 0 select _i;if(!isNull(_08a))then{(kg9fav select 3)set[_i,getPosWorld _08a];}else{if(kg9fav select 1 select _i!="")then{_pos=kg9fav select 3 select _i;_09a=ASLtoAGL(_pos)nearObjects[kg9fav select 1 select _i,100]select 0;if(isNil{_09a})then{_09a=objNull;};kg9fav select 1 set[_i,""];kg9fav select 0 set[_i,_09a];}else{if(kg9fav select 4 select _i==0)then{(kg9fav select 4)set[_i,diag_tickTime];}else{if((kg9fav select 4 select _i)+kg2sky<diag_tickTime)then{_07a=_i;};};};};};if(_07a>=0)then{for "_i" from 0 to count(kg9fav)-1 do{(kg9fav select _i)deleteAt _07a;};};if(visibleMap)then{if(isNull(uiNamespace getVariable "client_createMarkerDisplay"))then{if(!isNull(findDisplay 54))then{_0a=findDisplay 54;uiNamespace setVariable["client_createMarkerDisplay",_0a];(_0a displayCtrl 1)ctrlAddEventHandler["ButtonClick",{(_this select 0)call kgu14n}];};};};if(kgfv3c>0)then{if(kg3gqu==0)then{kg3gqu=diag_tickTime+0.1;};if(diag_tickTime>=kg3gqu)then{kgfv3c=kgfv3c-1;kg3gqu=0;playSound "FD_Start_F";};};if(kgbo7u)then{if(diag_tickTime>kg5rtx+300)then{if(call kgv2g2)then{kg5rtx=diag_tickTime;kgkndf=false;kgbo7u=false;};};};if(!isNull(kgca36))then{_pos=getPosWorld kgca36;_0ab=getPosWorld kgca36;_0ab set[2,(_0ab select 2)-1.2];if(lineIntersects[_pos,_0ab,objNull,kgca36]||getPos kgca36 select 2<1.2)exitWith{(attachedTo kgca36)spawn{sleep 10;deleteVehicle _this;};detach kgca36;kgca36=objNull;};};
#define kgo7vi            602
#define kgujxn       6304
#define kgt9si          6305
#define kgv5z7      6306
#define kgl87h        6307
#define kg5k6i         6308
_0a=findDisplay kgo7vi;kgle6q=(if(kg5ky3||!isNull _0a)then{call kgpwol}else{0});if(!isNull _0a)then{_0bb=_0a getVariable["repack_mags_button",controlNull];_0cb=_0a getVariable["load_uniform_text",controlNull];_0db=_0a getVariable["load_vest_text",controlNull];_0eb=_0a getVariable["load_backpack_text",controlNull];_0fb=_0a getVariable["load_total_text",controlNull];if(isNull _0bb)then{_0gb=ctrlPosition(_0a displayCtrl 1002);_0bb=_0a ctrlCreate["RscButtonMenu",-1];_0bb buttonSetAction "call kgx931";_0bb ctrlSetText localize "STR_KOH_Dlg_RepackMagazines";_0bb ctrlSetPosition[(_0gb select 0),(_0gb select 1)+(_0gb select 3)+0.01,(_0gb select 2)/2,ctrlPosition _0bb select 3];_0bb ctrlCommit 0;{_0p=_0a ctrlCreate["RscLoadingText",-1];_0p ctrlSetPosition ctrlPosition(_0a displayCtrl _x);_0p ctrlSetFontHeight((ctrlPosition _0p select 3)*0.65);_0p ctrlCommit 0;switch(_x)do{case kgujxn:{_0cb=_0p};case kgt9si:{_0db=_0p};case kgv5z7:{_0eb=_0p};};_0a displayCtrl _x ctrlEnable false;}forEach[kgujxn,kgt9si,kgv5z7];_0fb=_0a ctrlCreate["RscLoadingText",-1];_0fb ctrlSetPosition ctrlPosition(_0a displayCtrl kg5k6i);_0fb ctrlSetFontHeight((ctrlPosition _0fb select 3)*1);_0fb ctrlCommit 0;_0a displayCtrl kg5k6i ctrlEnable false;_0a setVariable["repack_mags_button",_0bb];_0a setVariable["load_uniform_text",_0cb];_0a setVariable["load_vest_text",_0db];_0a setVariable["load_backpack_text",_0eb];_0a setVariable["load_total_text",_0fb];};_0bb ctrlEnable(kgle6q>0);_0hb=getNumber(configFile>>"CfgVehicles">>getText(configFile>>"CfgWeapons">>uniform player>>"ItemInfo">>"containerclass")>>"maximumload");_0ib=getNumber(configFile>>"CfgVehicles">>getText(configFile>>"CfgWeapons">>vest player>>"ItemInfo">>"containerclass")>>"maximumload");_0jb=getNumber(configFile>>"CfgVehicles">>backpack player>>"maximumload");_0kb=getNumber(configFile>>"CfgInventoryGlobalVariable">>"maxSoldierLoad")/(player getUnitTrait "loadCoef");_0cb ctrlSetText(if(_0hb==0)then{""}else{format["%1 / %2",round(loadUniform player*_0hb),_0hb]});_0db ctrlSetText(if(_0ib==0)then{""}else{format["%1 / %2",round(loadVest player*_0ib),_0ib]});_0eb ctrlSetText(if(_0jb==0)then{""}else{format["%1 / %2",round(loadBackpack player*_0jb),_0jb]});_0fb ctrlSetText format["%1 / %2",round(loadAbs player),round(_0kb)];};if(kgy1pz)then{kgy1pz=false;call kgoxgo;};};kgu14n={private["_0k","_0lb"];_0k=(ctrlParent _this)displayCtrl 101;_0lb=ctrlText _0k;if(_0lb!="")then{_0lb=": "+_0lb};_0k ctrlSetText(profileName+_0lb);false};kg83u4={if(side group player==(_this select 1))then{kg9nxt pushBack(_this select 0);(_this select 0)setVariable["laser_name",toString(_this select 2)];};for "_i" from 0 to count(kg9nxt)-1 do{kg9nxt deleteAt(kg9nxt find objNull);};};kgb9fq={kgbgkr=call kgiqkw;if(kgbgkr>=2000)then{setTerrainGrid 5;}else{setTerrainGrid 25;};setViewDistance kgbgkr;};kgiqkw={(switch(true)do{case(vehicle player==player||(vehicle player)isKindOf "ParachuteBase"):{kg3cht select 0};case(kgwsg1 isKindOf "Plane"&&getNumber(configFile>>"CfgVehicles">>typeOf kgwsg1>>"vtol")==0):{kg3cht select 3};case(kgwsg1 isKindOf "Air"):{kg3cht select 2};default{kg3cht select 1};})max 300;};kg9lxi={if(worldName=="Tanoa")exitWith{daytime<6.5||daytime>18.5};daytime<4.5||daytime>19.5};kgyb9y={call kg9lxi};kgntp1={worldName=="Tanoa"};kgzehu={private["_0mb","_0ba"];_0mb=configFile>>"CfgVehicles">>typeOf(_this);_0ba=[getNumber(_0mb>>"cargocaneject")==1,getNumber(_0mb>>"drivercaneject")==1];private["_0nb"];_0nb=_0mb>>"turrets";for "_i" from 0 to(count _0nb-1)do{private["_0ob","_0pb"];_0ob=_0nb select _i;_0pb=_0ob>>"turrets";_0ba set[count _0ba,getNumber(_0ob>>"caneject")==1];for "_j" from 0 to(count _0pb-1)do{private["_0qb"];_0qb=_0pb select _j;_0ba set[count _0ba,getNumber(_0qb>>"caneject")==1];};};_0ba};kg7jca={private["_0ba","_0tb"];_0ba=[kgq7q9,kgecog];private["_0nb","_0rb"];_0nb=configFile>>"CfgVehicles">>typeOf(_this)>>"turrets";_0rb=_this isKindOf "Air";for "_i" from 0 to(count _0nb-1)do{private["_0ob","_0pb"];_0ob=_0nb select _i;_0pb=_0ob>>"turrets";switch(true)do{case(getNumber(_0ob>>"isPersonTurret")==1):{_0ba set[count _0ba,kgeu3n];};case(getNumber(_0ob>>"iscopilot")==1&&_0rb):{_0ba set[count _0ba,kgovrv];};case(getNumber(_0ob>>"primaryobserver")==1):{_0ba set[count _0ba,kg24iz];};default{_0ba set[count _0ba,kgghw9];};};for "_j" from 0 to(count _0pb-1)do{private["_0qb"];_0qb=_0pb select _j;switch(true)do{case(getNumber(_0qb>>"isPersonTurret")==1):{_0ba set[count _0ba,kgeu3n];};case(getNumber(_0qb>>"iscopilot")==1&&_0rb):{_0ba set[count _0ba,kgovrv];};case(getNumber(_0qb>>"primaryobserver")==1):{_0ba set[count _0ba,kg24iz];};default{_0ba set[count _0ba,kgghw9];};};};};_0ba};kgoqp4={private["_0nb","_0sb"];_0nb=configFile>>"CfgVehicles">>typeOf(_this)>>"turrets";_0sb=[];for "_i" from 0 to(count _0nb-1)do{private["_0ob","_0pb"];_0ob=_0nb select _i;_0pb=_0ob>>"turrets";_0sb=_0sb+[[_i]];for "_j" from 0 to(count _0pb-1)do{private["_0qb"];_0qb=_0pb select _j;_0sb=_0sb+[[_i,_j]];};};_0sb};kgicd4={private["_0tb","_0ba","_0ub","_0vb"];_0tb=[];{_0tb set[count _0tb,_this turretUnit _x];}forEach kgk9s3;_0ub=driver _this;_0vb=[];{if(alive _x)then{_0vb set[count _0vb,_x];};}forEach((crew _this)-[_0ub]-_0tb);if(!alive _0ub)then{_0ub=objNull;};_0ba=[_0vb,_0ub];{_0ba set[count _0ba,(if(alive _x)then{_x}else{objNull})];}forEach _0tb;_0ba};kgybu7={private["_0wb","_0xb","_0ba"];_0wb=_this select 0;_0xb=_this select 1;if(count(_0wb)!=count(_0xb))exitWith{false};if(count(_0wb select 0)!=count(_0xb select 0))exitWith{false};_0ba=(for "_i" from 1 to count(_0wb)-1 do{if(isNull(_0wb select _i)&&!isNull(_0xb select _i))exitWith{false};if(!isNull(_0wb select _i)&&isNull(_0xb select _i))exitWith{false};if(!isNull(_0wb select _i)&&!isNull(_0xb select _i)&&(_0wb select _i)!=(_0xb select _i))exitWith{false};});if(isNil{_0ba})then{_0ba=true;};_0ba};kgm9on={private["_0tb","_0ba"];_0tb=[];{_0tb set[count _0tb,_this turretUnit _x==player];}forEach kgk9s3;_0ba=[(count _0tb=={!_x}count _0tb)&&(driver _this!=player),driver _this==player];{_0ba set[count _0ba,_x];}forEach _0tb;_0ba};kgv3qu={private["_0wb","_0xb","_0ba"];_0wb=_this select 0;_0xb=_this select 1;if(count(_0wb)!=count(_0xb))exitWith{false};_0ba=true;for "_i" from 0 to count(_0wb)-1 do{if(((_0wb select _i)&&!(_0xb select _i))||(!(_0wb select _i)&&(_0xb select _i)))exitWith{_0ba=false;};};_0ba};kgug1l={private["_0yb","_m","_0zb"];_0yb=floor(_this/3600);_m=floor((_this%3600)/60);_0zb=floor(_this%60);if(_0zb<10)then{_0zb=format["0%1",_0zb]}else{_0zb};if(_m<10)then{_m=format["0%1",_m]}else{_m};if(_0yb>0)then{format["%1:%2:%3",_0yb,_m,_0zb];}else{format["%1:%2",_m,_0zb];};};kgxugz={private["_0ba","_01b","_02b"];if(_this select 0==_this select 1)exitWith{true};_0ba=false;_01b=(if(isNil{_this select 2})then{"CfgWeapons"}else{_this select 2});_02b=configFile>>_01b>>(_this select 0);for "_i" from 0 to 4 do{if(!isNil{_02b})then{_02b=inheritsFrom(_02b);if(configName(_02b)==_this select 1)exitWith{_0ba=true;};};};_0ba};kg5eo6={_pos=(switch(typeName(_this))do{case(typeName objNull):{player reveal[_this,4];_pos=getPosATL _this;_03b=boundingBox _this;_pos set[0,(_pos select 0)+(_03b select 1 select 1)];_pos};case(typeName[]):{_this};default{nil};});if(isNil{_pos})exitWith{systemChat "Cannot TP, bad parameter";};_pos spawn{_this call kgwg87;player setPosATL _this;};};kg1f2s={_0ba=false;{if((_x distance(_this select 0))<(_this select 1))exitWith{_0ba=true;};}forEach playableUnits;_0ba};kgktel={_0ba=0;{if((_x distance(_this select 0))<(_this select 1))exitWith{_0ba=_0ba+1;};}forEach playableUnits;_0ba};kgv5he={_0nb=configFile>>"CfgVehicles">>(typeOf _this)>>"turrets";((count _0nb)>0)};kgmmqu={if(isNil{kgnine})exitWith{0};private["_04b"];_04b=0;{if(side group _x==_this)then{_04b=_04b+1;};}forEach kgnine;_04b};kgf2lk={_this setVehicleAmmo 1;if(local _this)then{_this call kg1y2o;};};kgphwi={if(_this select 1==player)then{kg949t=diag_tickTime;kgnhig=damage(_this select 0);kg4zpo=_this;kg3xkp={_x=="FirstAidKit"}count(items player);};};kgk7qv=[];kgnebq={{if(!alive _x)then{_x removeEventHandler["HitPart",(_x getVariable["eh_hp",-1])];};}forEach kgk7qv;{if(_x getVariable["eh_hp_unit",objNull]!=_x)then{_x setVariable["eh_hp",_x addEventHandler["HitPart",{call kgwdxw}]];_x setVariable["eh_hp_unit",_x];_x setVariable["koh_last_hit_at",-1];};}forEach _this;kgk7qv=_this;};kgwdxw={if!(alive(_this select 0 select 0))exitWith{};if!(_this select 0 select 10)exitWith{_05b setVariable["koh_last_hit_at",-1];};(_this select 0)params["_05b","_shooter","_07b","_06b","_velocity","_08b"];if(_06b distance2d[0,0]==0)exitWith{};_0c=kghb1e find _07b;if(_0c<0)exitWith{};_05b setVariable["koh_last_hit_at",diag_tickTime];_05b setVariable["koh_last_hit_distance",kgnn3w select _0c vectorDistance _06b];_05b setVariable["koh_last_hit_headshot","head" in _08b];};
#define kgxe5w		(60 * 10)
kgziah={if(_this getVariable["koh_last_hit_at",-1]>0)then{_09b=_this getVariable["koh_last_hit_distance",0];_0ac=_this getVariable["koh_last_hit_headshot",false];_09b=round _09b;if(_09b>=500)then{[[-1,(if((_this getVariable["distance_reward_given_at",0])+kgxe5w>diag_tickTime)then{if(_0ac)then{kgh24d}else{kg7v6a}}else{if(_0ac)then{kgmd15}else{kgbwz5}}),_09b]]call kgt98j;_this setVariable["distance_reward_given_at",diag_tickTime];};};};kgpwol={private _0bc=[];{_0bc append magazinesAmmoCargo _x;}forEach(call kgwkbb);private _0cc=[];{_0cc pushBackUnique toLower(_x select 0);}forEach _0bc;private _0dc=0;{private _0ec=_x;private _0fc=getNumber(configFile>>"CfgMagazines">>_0ec>>"count");private _0gc={_x select 0==_0ec&&_x select 1<_0fc}count _0bc;if(_0gc>=2)then{_0dc=_0dc+_0gc;};}forEach _0cc;_0dc};kgoxgo={private _0hc=call kgwkbb select{!isNull _x};private _0cc=[];private _0ic=[];private _0bc=[];{private _0ba=(magazinesAmmoCargo _x apply{private _0ec=toLower(_x select 0);_0cc pushBackUnique _0ec;_x set[0,_0ec];_x;_x});_0ic pushBack _0ba;_0bc append _0ba;}forEach _0hc;{private _0ec=_x;private _0jc=_0bc select{_x select 0==_0ec};private _0fc=getNumber(configFile>>"CfgMagazines">>_0ec>>"count");if({_x select 1<_0fc}count _0jc>=2)then{private _0kc=0;{_0kc=_0kc+(_x select 1)}forEach _0jc;private _0lc=_0kc%_0fc;private _0mc=floor(_0kc/_0fc);player removeMagazines _0ec;{if(_0mc==0)exitWith{(_0hc select _forEachIndex)addMagazineAmmoCargo[_0ec,1,_0lc];};if(_0mc>0)then{(_0hc select _forEachIndex)addMagazineCargoGlobal[_0ec,_x min _0mc];_0mc=_0mc-_x;};if(_0mc<0)exitWith{(_0hc select _forEachIndex)addMagazineAmmoCargo[_0ec,1,_0lc];};}forEach(_0ic apply{{_x select 0==_0ec}count _x});};}forEach _0cc;};kgwkbb={[uniformContainer player,vestContainer player,backpackContainer player];};