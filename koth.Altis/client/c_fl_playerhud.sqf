/*
	ArmA 3 King of Hill
	Code written by Sa-Matra
	Using this code without Sa-Matra's direct permission is forbidden
	
	Special build for Gamed.de
	
	Build ETYKMBSIGDHGNALL
*/
#include "hpp\idcs.hpp"
#include "hpp\defines.hpp"
kgxcee={if(!isNil{kgmadd})exitWith{};if(isNil{kgmadd})then{kgmadd=true;};kgocem cutRsc["KingOfHill_PlayerHUD","PLAIN"];private["_0a"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";(_0a displayCtrl kg3rnx)ctrlShow false;(_0a displayCtrl kgun13)ctrlSetFade 1;(_0a displayCtrl kgun13)ctrlCommit 0;kgvvfv=true;kg28ik=serverTime;kg5kgr=0;kgl8r9=[];kgvsvh=[(profilenamespace getvariable['GUI_BCG_RGB_R',0.3843]),(profilenamespace getvariable['GUI_BCG_RGB_G',0.7019]),(profilenamespace getvariable['GUI_BCG_RGB_B',0.8862])]call kg64eh;kgt3k1=kgtm2q+"i\p.paa";kg95u2=[kgtm2q+"i\towericon1.paa",kgtm2q+"i\towericon2.paa",kgtm2q+"i\towericon3.paa",kgtm2q+"i\towericon4.paa",kgtm2q+"i\towericon5.paa",kgtm2q+"i\towericon6.paa",kgtm2q+"i\towericon7.paa"];kgiwfh=false;kgffos=0;call kgxqcw;false call kg1rk1;true spawn kgjm5s;true spawn kgeh3a;true spawn kgo4of;true spawn kgoyfu;true spawn kgg7e2;kgx6kt=true;};kg1rk1={((uiNamespace getVariable "KingOfHill_PlayerHUD")displayCtrl kgvnia)ctrlShow _this;};kgrn2v={if!(call kgdfux)exitWith{};if(kgffos>0)then{if(diag_tickTime>kgffos)then{call kg3xqw;};};};kgspig={private["_06e"];_06e=getFatigue player;private["_0a","_07e","_08e","_09e"];_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";_07e=_0a displayCtrl kgun13;_08e=_0a displayCtrl kgug4z;_09e=(if(call kg9lxi)then{0.6}else{0});if(alive player&&!kg4bsk&&!kgkyng&&!visibleMap&&_06e>0.2&&kgmadd)then{if(!kgiwfh)then{_07e ctrlSetFade _09e;_07e ctrlCommit 1;kgiwfh=true;};}else{if(kgiwfh)then{_07e ctrlSetFade 1;_07e ctrlCommit 1;kgiwfh=false;};};_08e progressSetPosition _06e;};kgdfux={(missionNamespace getVariable["kgskxp",0])==kg27tr&&!isNil{kgx6kt}};
#define kg5w46	0,0.3,0.6
#define kggxim	0.5,0,0
#define kgjtga	0,0.5,0
#define kg573g	0.4,0,0.5
#define kgm8xt	[kg5w46,1]
#define kgfdnb	[kggxim,1]
#define kgdvdo	[kgjtga,1]
#define kgyrlb		[kg573g,1]
#define kg1r22		0.4
#define kg7e2l	0.9
kgjij6={switch(_this)do{case blufor:{kgm8xt};case opfor:{kgfdnb};case independent:{kgdvdo};default{kgyrlb};};};kgyugv={switch(_this)do{case blufor:{"004D99"};case opfor:{"800000"};case independent:{"008000"};default{"660080"};};};kgalk7={switch(_this)do{case blufor:{"ColorBLUFOR"};case opfor:{"ColorOPFOR"};case independent:{"ColorIndependent"};default{"ColorCivilian"};};};kg64eh={_0af={_0ca=_this;_0bf=[];while{_0ca>0}do{_0cf=_0ca%16;_0bf=[(if(_0cf>9)then{65}else{48})+(_0cf%10)]+_0bf;_0ca=(_0ca-_0cf)/16;};if(count _0bf==0)then{_0bf=[48,48];};if(count _0bf<2)then{_0bf=[48]+_0bf;};toString _0bf};_0df="";for "_i" from 0 to 2 do{_02b=round(255*(_this select _i));_0df=_0df+(_02b call _0af);};_0df};
#define kge71a		0
#define kg4qoy		1
#define kgn2na		2
#define kgwlxa		3
#define kggpc4		4
#define kgejs8	5
kgo4of={kgy2y7=localize format["STR_KOH_Gen_Base%1",playerSide];kgyxwp=localize "STR_KOH_Gen_BaseENEMY";kgcgri="安全区";kg94g6=kge71a;kgrg2h=[0,0,0,1];kgxw7c=[0,0,0,1];kgzaw7="";kgm3da=playerSide call kgjij6;kgm3da set[3,kg7e2l];kglg8o=playerSide call kgjij6;kglg8o set[3,kg1r22];kganfk=[0,0,0,kg7e2l];kghg8r=[0,0,0,kg1r22];
#define kgkihf			"维修站"
#define kgysgk		"安全区"
#define kgr59c			10
#define kgzi7t			"\A3\ui_f\data\igui\cfg\cursors\iconRepairVehicle_ca.paa"
#define kgj7wt			"\A3\ui_f\data\igui\rscingameui\rscdisplayvoicechat\microphone_ca.paa"
#define kg42ds			"iconManVirtual"
#define kg9mk7			"\A3\modules_f\data\iconModule_ca.paa"
private["_0ef","_0ff"];disableSerialization;waitUntil{!isNull(findDisplay 12 displayCtrl 51)};_0ef=findDisplay 12 displayCtrl 51;if(!isNil{kgabpn})then{_0ef ctrlRemoveEventHandler["Draw",kgabpn];};kgabpn=_0ef ctrlAddEventHandler["Draw",{[_this,false]call kgxbru}];waitUntil{!isNull((uiNamespace getVariable "RscMiniMap")displayCtrl 101)};_0ff=((uiNamespace getVariable "RscMiniMap")displayCtrl 101);if(!isNil{kgcgzu})then{_0ff ctrlRemoveEventHandler["Draw",kgcgzu];};kgcgzu=_0ff ctrlAddEventHandler["Draw",{[_this,true]call kgxbru}];};kgxbru={_0ef=_this select 0 select 0;_0ff=_this select 1;_0gf=(ctrlMapScale _0ef);_0ja=player getVariable["koh_safe",-1];_0hf=_0ja<serverTime&&_0ja>0;_0if=call kge94l;if(kgskxp==kg27tr)then{if(_0hf)then{_0ef drawEllipse[kgxvny,kgtbgi,kgwuoy,kghrr8,kglg8o,"#(argb,8,8,3)color(1,1,1,1)"];_0ef drawEllipse[kgxvny,kgtbgi,kgwuoy,kghrr8,kglg8o,""];}else{_0ef drawEllipse[getPosASL kg2e5i,kgh5it,kgh5it,0,kglg8o,"#(argb,8,8,3)color(1,1,1,1)"];_0ef drawEllipse[getPosASL kg2e5i,kgh5it,kgh5it,0,kglg8o,""];_0ef drawEllipse[kg9tp7,kg6rhv,kg6rhv,0,kglg8o,"#(argb,8,8,3)color(1,1,1,1)"];_0ef drawEllipse[kg9tp7,kg6rhv,kg6rhv,0,kglg8o,""];_0ef drawEllipse[kgxvny,kgtbgi,kgwuoy,kghrr8,kgm3da,""];};if(kgmhlg)then{_0ef drawRectangle[kgdva1,kg7vk8,kgu85m,kg12rz,kgrg2h,"#(argb,8,8,3)color(1,1,1,1)"];_0ef drawRectangle[kgdva1,kg7vk8,kgu85m,kg12rz,kgrg2h,""];}else{_0ef drawEllipse[kgdva1,kg7vk8,kgu85m,kg12rz,kgrg2h,"#(argb,8,8,3)color(1,1,1,1)"];_0ef drawEllipse[kgdva1,kg7vk8,kgu85m,kg12rz,kgrg2h,""];};for "_i" from 0 to count(kgubgt)-1 do{if((kgubgt select _i)!=playerSide)then{_0ef drawEllipse[kgpli7 select _i,kgtbgi,kgwuoy,kgzdcu select _i,kghg8r,"#(argb,8,8,3)color(1,1,1,1)"];_0ef drawEllipse[kgpli7 select _i,kgtbgi,kgwuoy,kgzdcu select _i,kghg8r,""];};};};if(_0gf<=0.08681)then{if(!isNil{kg1gtz})then{{if(!isNil{_x})then{_0ef drawIcon[kg95u2 select _forEachIndex,[1,1,1,1],_x,24,24,0,"",2,0.04,"PuristaMedium","right"];};}forEach kg1gtz;};};{if(_x getVariable["ready",false]&&({_x getVariable["show_me_on_map",true]||group _x==group player||_0if}count(crew _x)>0))then{if((side group player==side group _x)&&(effectiveCommander(vehicle _x)==_x))then{_0qa=getDirVisual _x;_01c=call{if(vehicle _x==_x)exitWith{if(getPlayerChannel _x>-1)exitWith{_0qa=0;kgj7wt};kg42ds};if({if(getPlayerChannel _x>-1)exitWith{1}}count(crew vehicle _x)>0)exitWith{_0qa=0;kgj7wt};kg9mk7};_0df=if({group _x==group player}count(crew _x)>0)then{[0.333,0.8,0.333,1]}else{[0.8,0.8,0.8,1]};_0se=(if(vehicle _x==_x)then{_x call kgwnst}else{_05d=vehicle _x;_0jf="";{if(_x getVariable["show_me_on_map",true]||group _x==group player||_0if)then{_0jf=_0jf+(if(_forEachIndex!=0)then{", "}else{""})+(_x call kgwnst);};}forEach(crew _05d);format["%1: %2",getText(configFile>>"CfgVehicles">>(typeOf _05d)>>"displayname"),_0jf];});if(_0if)then{if!(_x getVariable["show_me_on_map",true])then{_0df set[3,0.5];};};_0ef drawIcon[_01c,_0df,visiblePositionASL _x,24,24,_0qa,_0se,2,0.04,"PuristaMedium","right"];};};}forEach kgnine;{_05d=_x select 0;if(alive _05d)then{if(count(crew(_05d))==0)then{_0ef drawIcon[kg9mk7,[0.6,0.48,0.38,1],visiblePositionASL _05d,24,24,getDirVisual _05d,getText(configFile>>"CfgVehicles">>(typeOf _05d)>>"displayname"),2,0.04,"PuristaMedium","right"];};};}forEach kg8u9s;{if((_x getVariable["revive_side",civilian]==playerSide)&&alive(_x getVariable["revive_player",objNull]))then{_0ef drawIcon["pictureHeal",[1,0,0,1],getPosASL _x,16,16,0,_x call kgz46d,2,0.04,"PuristaMedium","right"];};}forEach kgonou;if(kgskxp==kg27tr)then{_0kf=+kgdva1;_0kf set[0,(_0kf select 0)+(kg7vk8 max kgu85m)+10];_0ef drawIcon["iconExplosiveAT",[1,1,1,1],_0kf,1,1,0,kgzaw7,2,0.05,"PuristaMedium","right"];};if(kgskxp==kg27tr)then{for "_i" from 0 to count(kgubgt)-1 do{if((kgubgt select _i)==playerSide)then{if(_0hf)then{_0lf=+(kgpli7 select _i);_0lf set[0,(_0lf select 0)+kgjgtv+kgr59c];_0ef drawIcon["iconExplosiveAT",[1,1,1,1],_0lf,1,1,0,kgy2y7,2,0.05,"PuristaMedium","right"];if(_0gf<0.055)then{_0lf set[1,(_0lf select 1)-800*_0gf];_0ef drawIcon["iconExplosiveAT",[1,1,1,1],_0lf,1,1,0,kgysgk,2,0.04,"PuristaMedium","right"];};}else{if(_0gf<=1)then{_0lf=getPosASL(kghznt select _i);_0lf set[0,(_0lf select 0)+kgh5it+kgr59c];_0ef drawIcon["iconExplosiveAT",[1,1,1,1],_0lf,1,1,0,kgy2y7,2,0.05,"PuristaMedium","right"];if(_0gf<0.055)then{_0lf set[1,(_0lf select 1)-800*_0gf];_0ef drawIcon["iconExplosiveAT",[1,1,1,1],_0lf,1,1,0,kgysgk,2,0.04,"PuristaMedium","right"];};_0lf=+(kgmksk select _i);_0lf set[0,(_0lf select 0)+kg6rhv+kgr59c];_0ef drawIcon["iconExplosiveAT",[1,1,1,1],_0lf,1,1,0,kgkihf,2,0.05,"PuristaMedium","right"];if(_0gf<0.055)then{_0lf set[1,(_0lf select 1)-800*_0gf];_0ef drawIcon["iconExplosiveAT",[1,1,1,1],_0lf,1,1,0,kgysgk,2,0.04,"PuristaMedium","right"];};};};if(_0gf<0.055)then{_0ef drawIcon[kgt3k1,[1,1,1,1],getPosASL(kghznt select _i),20,20,0,"",2,0.04,"PuristaMedium","right"];_0ef drawIcon[kgzi7t,[1,1,1,1],(kgmksk select _i),20,20,0,"",2,0.04,"PuristaMedium","right"];};}else{_0lf=+(kgpli7 select _i);_0lf set[0,(_0lf select 0)+kgjgtv+kgr59c];_0ef drawIcon["iconExplosiveAT",[1,1,1,1],_0lf,1,1,0,kgyxwp,2,0.05,"PuristaMedium","right"];if(_0gf<0.055)then{_0lf set[1,(_0lf select 1)-800*_0gf];_0ef drawIcon["iconExplosiveAT",[1,1,1,1],_0lf,1,1,0,kgysgk,2,0.04,"PuristaMedium","right"];};};};};if(count(kg9fav select 0)>0)then{_0mf=0;kg9fav params["_0nf","_subs","_0pf","_0qf","_0of"];for "_i" from 0 to count(_0nf)-1 do{if(isNull(_0nf select _i))then{_0mf=((_0of select _i)+kg2sky-diag_tickTime)/kg2sky;_0ef drawLine[_0pf select _i,_0qf select _i,[1,1,1,_0mf]];_0ef drawIcon["\A3\ui_f\data\map\groupicons\waypoint.paa",[1,1,1,(_0mf*2)min 1],_0qf select _i,24,24,0,"",0,0.04,"PuristaMedium","right"];}else{_0ef drawArrow[_0pf select _i,_0qf select _i,[1,1,1,1]];};};};{if(alive _x)then{_0ef drawIcon["\A3\ui_f\data\map\markers\military\destroy_ca.paa",[1,0,0,1],getPosWorld _x,14,14,0,(_x getVariable "laser_name"),0,0.04,"PuristaMedium","right"];};}forEach kg9nxt;};kg662d={private["_0w","_0rf","_0sf"];_0rf=0;_0sf=-1;_0w=call kgnoik;for "_i" from 0 to count(kgubgt)-1 do{private["_04b"];_04b=_0w select _i;if(_04b>_0rf)then{_0sf=_i;};if(_0rf==_04b)then{_0sf=-1;};_0rf=_0rf max _04b;};if(({_x==0}count _0w)==(count _0w))then{_0sf=-2;};switch(true)do{case(_0sf>=0):{switch(kgubgt select _0sf)do{case blufor:{kg94g6=kg4qoy;kgrg2h=[kg5w46,kg1r22];kgxw7c=[kg5w46,kg7e2l];kgzaw7="战区由蓝军控制";};case opfor:{kg94g6=kgn2na;kgrg2h=[kggxim,kg1r22];kgxw7c=[kggxim,kg7e2l];kgzaw7="战区由红军控制";};case independent:{kg94g6=kgwlxa;kgrg2h=[kgjtga,kg1r22];kgxw7c=[kgjtga,kg7e2l];kgzaw7="战区由绿军控制";};default{kg94g6=kggpc4;kgrg2h=[0,0,0,kg1r22];kgxw7c=[0,0,0,kg7e2l];kgzaw7="";};};};case(_0sf==-1):{kg94g6=kgejs8;kgrg2h=[kg573g,kg1r22];kgxw7c=[kg573g,kg7e2l];kgzaw7="战区陷入争夺";};default{kg94g6=kge71a;kgrg2h=[0.7,0.7,0.7,kg1r22];kgxw7c=[0.7,0.7,0.7,kg7e2l];kgzaw7="战区未被控制";};};};kgwnst={if(isStreamFriendlyUIEnabled)then{if(player==_this)then{localize "STR_KOH_Me2"}else{if(group player==group _this)then{localize "STR_KOH_Groupmate2"}else{localize "STR_KOH_Teammate2"};};}else{name _this};};kgz46d={if(isStreamFriendlyUIEnabled)then{if(_this getVariable["revive_player",objNull]==player)then{localize "STR_KOH_Me2"}else{if(_this getVariable["revive_group",grpNull]==group player)then{localize "STR_KOH_Groupmate2"}else{localize "STR_KOH_Teammate2"};};}else{_this getVariable["revive_name","Player"]};};kgsuvd={private["_0a","_0p"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";_0p=(_0a displayCtrl kg8zkp);kg16zo=objNull;kg32bv=0;kgvhv8=90;while{true}do{_04e=[];_04e=_04e+[format["player dir = %1",getDir(player)]];_04e=_04e+[format["saved dir = %1",kg32bv]];_04e=_04e+[format["dir change = +/-%1",kgvhv8]];_04e=_04e+[format["<t color='#aaaaff'>(y / shift+y)</t> - save dir cT / save dir kg16zo"]];_04e=_04e+[format["<t color='#aaaaff'>(u / shift+u)</t> - load dir kg16zo / load dir player"]];_04e=_04e+[format["<t color='#aaaaff'>(ctrl + arrows)</t> - set kg16zo dir"]];_04e=_04e+[format["<t color='#aaaaff'>(ctrl + shift + arrows)</t> - set player dir"]];_04e=_04e+[format["<t color='#aaaaff'>(alt + arrows [+ shift])</t> - set kg16zo Z"]];_04e=_04e+[format["<t color='#aaaaff'>(arrows [+ shift])</t> - set kg16zo XY"]];_04e=_04e+[""];_04e=_04e+[format["====== kg16zo <t color='#aaaaff'>(t)</t> ======<br/>kg16zo = %1<br/>class = %2<br/>name = %3<br/>dir = %4<br/>local = %5",(if(isNull(kg16zo))then{"objNull"}else{kg16zo}),typeOf kg16zo,getText(configFile>>"CfgVehicles">>typeOf(kg16zo)>>"displayname"),getDir(kg16zo),local kg16zo]];_04e=_04e+[""];_04e=_04e+[format["=== cursorTarget ===<br/>cT = %1<br/>class = %2<br/>name = %3<br/>dir = %4<br/>local = %5",(if(isNull(cursorTarget))then{"objNull"}else{cursorTarget}),typeOf cursorTarget,getText(configFile>>"CfgVehicles">>typeOf(cursorTarget)>>"displayname"),getDir(cursorTarget),local cursorTarget]];_0s="";{if(_0s!="")then{_0s=format["%1<br/>",_0s];};_0s=format["%1%2",_0s,_x];}forEach _04e;_0p ctrlSetStructuredText parseText _0s;sleep 0.1;};};kgoyfu={private["_0tf","_0a","_0uf","_02f","_05f","_06f","_0wf","_0vf","_03f","_04f","_0xf","_0yf"];disableSerialization;waitUntil{!isNull(findDisplay 46)};_0tf=findDisplay 46;_0uf=_0tf displayCtrl 11400;_0vf=(_0tf displayCtrl 1000);_0wf=(_0tf displayCtrl 1001);_0xf=!(ctrlFade _0uf==1);_0yf=(if(_0xf)then{0}else{1.12*2});_x=safezoneX+safezoneW-18.5*(((safezoneW/safezoneH)min 1.2)/40);_0zf=safezoneY+safezoneH-(5.6-_0yf)*((((safezoneW/safezoneH)min 1.2)/1.2)/25);_01f=8.8*(((safezoneW/safezoneH)min 1.2)/40);_0yb=5.3*((((safezoneW/safezoneH)min 1.2)/1.2)/25);_0uf ctrlSetPosition[_x,_0zf,_01f,_0yb];_0uf ctrlCommit 0;if(_0xf)then{_02f=_0tf displayCtrl 1200;_02f ctrlShow false;_03f=ctrlPosition _0wf;_0wf ctrlSetText format["A3 Development"];_0wf ctrlSetPosition[0,_03f select 1,_01f,_03f select 3];_0wf ctrlCommit 0;_04f=ctrlPosition _0vf;_0vf ctrlSetPosition[0,_04f select 1,_01f,_04f select 3];_0vf ctrlCommit 0;};_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";_05f=_0a displayCtrl kgu7ys;_05f ctrlShow _this;_06f=(ctrlPosition _05f)select 3;_05f ctrlSetPosition[_x,_0zf,_01f,_06f];_05f ctrlSetTextColor[1,1,1,0.3];_05f ctrlCommit 0;_05f ctrlSetStructuredText parseText format["占山为王载具版<br/>Q群28398507<br/>Glass制作",kgg1ow];};kgg7e2={private["_0tf","_0uf","_07f"];disableSerialization;waitUntil{!isNull(findDisplay 46)};_0tf=findDisplay 46;_0uf=_0tf displayCtrl 11400;while{true}do{_07f=(ctrlPosition _0uf)select 0;_08f=isStreamFriendlyUIEnabled;waitUntil{sleep 1;_07f!=((ctrlPosition _0uf)select 0)||(!isStreamFriendlyUIEnabled&&_08f)||(isStreamFriendlyUIEnabled&&!_08f)};kgv91t=isStreamFriendlyUIEnabled;true spawn kgoyfu;};};kgz74g={kgmadd=_this;private["_0a","_0tf","_0uf","_02f","_05f","_06f"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";(_0a displayCtrl kgynkw)ctrlShow _this;(_0a displayCtrl kgnbv8)ctrlShow _this;_this spawn kgoyfu;};kgxqcw={call kgm9k5;call kgsii2;call kgfaiq;call kgg8m4;call kgxedq;call kgfhly;};kgm9k5={private["_0a"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";(_0a displayCtrl kgvlmj)ctrlSetStructuredText parseText format["<t color='#aaffaa'>%1 $</t>",kg4re9 call kgkzn8];};kgbz2a={private["_0a"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";(_0a displayCtrl kgvlmj)ctrlSetBackgroundColor(if(_this)then{[0,1,0,1]}else{[1,0,0,1]});true spawn{sleep 0.5;private["_0a"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";(_0a displayCtrl kgvlmj)ctrlSetBackgroundColor[0,0,0,0];};};kgsii2={private["_0a"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";(_0a displayCtrl kgwnah)progressSetPosition(((kg9ig1/kg7bkn)max 0)min 1);(_0a displayCtrl kgxfzf)ctrlSetStructuredText parseText format["%1 / %2",kg9ig1 call kgkzn8,kg7bkn call kgkzn8];(_0a displayCtrl kgl82i)ctrlSetStructuredText parseText str(kgsoxm);};kgfaiq={private["_0a"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";for "_i" from 0 to count(kgubgt)-1 do{private["_0y"];_0y=(kgubgt select _i)call kgmmqu;(_0a displayCtrl(kg99pc+count(kgubgt)-1-_i))ctrlSetStructuredText parseText(if(_0y==0)then{"-"}else{format["%1<img image='i\p.paa'/>",_0y]});};};kgjm5s={private["_09f","_0ag","_0w","_0bg"];_09f=[-1,-1,-1];_0ag=-1;waitUntil{waitUntil{sleep 1;_0w=call kgnoik;_0bg=call kgqmps;((_0w select 0)!=(_09f select 0))||((_0w select 1)!=(_09f select 1))||((_0w select 2)!=(_09f select 2))||(_0bg!=_0ag)};call kgg8m4;call kg662d;_09f=_0w;_0ag=_0bg;false;};};kgg8m4={private["_0a","_0w","_0bg","_0rf","_0sf","_0cg"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";if(isNil{if(isNull(_0a))then{nil}else{true}})exitWith{};_0w=call kgnoik;_0bg=call kgqmps;_0rf=0;_0sf=-1;_0cg=[];for "_i" from 0 to count(kgubgt)-1 do{private["_0s","_04b","_0dg","_0eg"];_0s=format["<t color='#%1'><t size='0.5'><img image='#(argb,8,8,3)color(0,0,0,0)'/><br/></t>",(kgubgt select _i)call kgyugv];_04b=_0w select _i;_0dg=_04b min 10;_0eg=(playerSide==(kgubgt select _i));_0fg=(floor(_04b/5)==0);if(_04b<=5)then{_0s=_0s+"<br/>";};for "_j" from 1 to _04b do{switch(true)do{case(_j>10):{};case(_0eg&&((_0fg&&(_j<=_0bg))||(!_0fg&&(_j>(_0dg-5))&&(_j<=(_0dg-5+_0bg))))):{_0s=_0s+"<img image='i\koh_pow.paa' color='#ffffff'/>";};case(_j==5&&_04b>10):{_0s=_0s+"<img image='i\koh_powp.paa'/>";};default{_0s=_0s+"<img image='i\koh_pow.paa'/>";};};if(_j==_0dg-5)then{_0s=_0s+"<br/>";};};_0s=_0s+"<br/><img image='i\koh_flag1.paa' size='5'/></t>";(_0a displayCtrl(kg7asu+count(kgubgt)-1-_i))ctrlSetStructuredText parseText _0s;if(_04b>_0rf)then{_0sf=_i;};if(_0rf==_04b)then{_0sf=-1;};_0rf=_0rf max _04b;};if((_0sf==-1)&&(_0rf>0))then{for "_i" from 0 to count(kgubgt)-1 do{if(_0w select _i==_0rf)then{_0cg set[count _0cg,_i];};};};if(kg5kgr<serverTime)then{for "_i" from 0 to count(kgubgt)-1 do{(_0a displayCtrl(kgrw9u+count(kgubgt)-1-_i))ctrlSetBackgroundColor(if(_i==_0sf)then{if(playerSide==(kgubgt select _i))then{[0,1,0,0.2]}else{[1,0,0,0.2]};}else{if(_i in _0cg)then{[0.4,0,0.5,0.3]}else{[0,0,0,0]};});};};};kgpse2={private["_0a"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";kg5kgr=serverTime+2;for "_i" from 0 to count(kgubgt)-1 do{(_0a displayCtrl(kgrw9u+count(kgubgt)-1-_i))ctrlSetBackgroundColor(if(kgubgt select _i==_this)then{if(playerSide==_this)then{[0,1,0,1]}else{[1,0,0,1]};}else{[0,0,0,0]});};true spawn{waitUntil{serverTime>kg5kgr};call kgg8m4;};};kgfhly={private["_0a","_0p","_0gg"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";for "_i" from 0 to 2 do{_0p=_0a displayCtrl(kgjqge+_i);_0gg=_0a displayCtrl(kg4tqb+_i);switch(true)do{case(_i<count(kgge9y)):{_0gg ctrlSetBackgroundColor[0,0,0,1];_0p ctrlSetStructuredText parseText(database_loadout_perksList select(database_loadout_perksIndexes find(kgge9y select _i))select 5);};case(_i<kg9ril):{_0gg ctrlSetBackgroundColor[0,0,0,0.5];_0p ctrlSetStructuredText parseText "";};default{_0gg ctrlSetBackgroundColor[0,0,0,0.2];_0p ctrlSetStructuredText parseText "";};};};};kgxedq={private["_0a","_06"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";_06=missionNamespace getVariable["kgvsc7",[0,0,0]];for "_i" from 0 to count(_06)-1 do{(_0a displayCtrl(kghl2h+count(kgubgt)-1-_i))ctrlSetStructuredText(if(_06 select _i<=0)then{text ""}else{text str(_06 select _i)});};};kgxsto={if(isNil "kgb6gb")exitWith{};if({isNil{_x}}count _this>0)exitWith{{format["KOH :: Errorous reward message ignored: %1",_this]call _x;}forEach[{systemChat _this},{diag_log _this}];diag_log format["KOH :: rewardPacket = %1",kg5pax];};kgl8r9 set[count kgl8r9,_this];call kgel7f;private["_0a","_0hg","_0ig","_0jg","_0kg","_0lg","_0zf"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";_0hg=_0a displayCtrl kgacld;_0ig=_0a displayCtrl kgkt7k;_0jg=ctrlPosition _0hg;_0zf=(_0jg select 1)+(10-(count(kgl8r9)min 10))*kgb6gb;_0kg=[_0jg select 2,_0zf,0,kgb6gb];_0lg=[0,_0zf,_0jg select 2,kgb6gb];_0ig ctrlSetPosition _0kg;_0ig ctrlSetFade 0.5;_0ig ctrlCommit 0;_0ig ctrlSetPosition _0lg;_0ig ctrlSetFade 1;_0ig ctrlCommit 0.4;if(_this select 6)then{playSound "FD_Timer_F";};};kgel7f={private["_0a","_0p","_0s"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";_0p=_0a displayCtrl kgacld;_0s="";for "_i" from 1 to 10 do{if(count(kgl8r9)>10-_i)then{private["_0mg"];_0mg=kgl8r9 select(10-_i);_0s=_0s+(_0mg select 0);_0ng=(if(count(_0mg)>4)then{_0mg select 4}else{false});_0og=(if(count(_0mg)>5)then{_0mg select 5}else{false});_0ng=false;_0og=false;if(_0mg select 1>0)then{_0s=_0s+format[" <t color='#%2'>%3%1 xp</t>",_0mg select 1,kgvsvh,(if(_0ng)then{"<img image='i\x2_16x32.paa'/>"}else{""})];};if(_0mg select 2>0)then{_0s=_0s+format[" <t color='#aaffaa'>%2%1 $</t>",_0mg select 2,(if(_0og)then{"<img image='i\x2_16x32.paa'/>"}else{""})];};};_0s=_0s+"<br/>";};_0p ctrlSetStructuredText parseText _0s;};kgeh3a={private["_0a","_0p","_0pg","_0rg","_0sg","_0tg","_0qg"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";_0p=_0a displayCtrl kgacld;_0pg=ctrlPosition _0p;_0qg=(_0pg select 3)/10;_0rg=+_0pg;_0rg set[1,(_0rg select 1)+_0qg];_0rg set[3,_0qg*9];kgb6gb=_0qg;waitUntil{waitUntil{count(kgl8r9)>0};waitUntil{diag_tickTime>(kgl8r9 select 0 select 3)};_0p ctrlSetPosition _0rg;_0p ctrlCommit 0.5;waitUntil{ctrlCommitted _0p};_0sg=kgl8r9;_0tg=[];for "_i" from 1 to(count(_0sg)-1)do{if(count(_0sg)>_i)then{_0tg set[_i-1,_0sg select _i];};};_0p ctrlSetPosition _0pg;_0p ctrlCommit 0;kgl8r9=_0tg;call kgel7f;false;};};
#define kg8ncv 15
kgs6zf={private["_0a","_0ug","_04e","_0r","_icon_fnc","_06l"];disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";_0ug=_0a displayCtrl kgynkw;if(player==vehicle player)exitWith{_0ug ctrlShow false;};_04e=[];_0r=parseText "<br/>";_0vg={private["_0uf","_name","_0qg"];_0uf=(group player==group _this);_name=if(isStreamFriendlyUIEnabled)then{if(player==_this)then{localize "STR_KOH_Me"}else{if(_0uf)then{localize "STR_KOH_Groupmate"}else{localize "STR_KOH_Teammate"};};}else{name _this};_0qg=(format["%1 <img image='%2'/><br/>",_name,switch(_0tc)do{case kgecog:{"a3\ui_f\data\IGUI\RscIngameUI\RscUnitInfo\role_driver_ca.paa"};case kgghw9:{"a3\ui_f\data\IGUI\RscIngameUI\RscUnitInfo\role_gunner_ca.paa"};case kg24iz:{"a3\ui_f\data\IGUI\RscIngameUI\RscUnitInfo\role_commander_ca.paa"};case kgovrv:{"a3\ui_f\data\IGUI\RscIngameUI\RscUnitInfo\role_commander_ca.paa"};case kgeu3n:{"a3\ui_f\data\IGUI\RscIngameUI\RscUnitInfo\role_cargo_ca.paa"};default{"a3\ui_f\data\IGUI\RscIngameUI\RscUnitInfo\role_cargo_ca.paa"};}]);if(_0uf)then{_0qg=format["<t color='#aaffaa'>%1</t>",_0qg];};_0qg};for "_i" from 1 to count(kguyfx)-1 do{private["_05b"];_05b=(kguyfx select _i);if(alive _05b)then{_0tc=kgv75b select _i;_04e set[count _04e,parseText(_05b call _0vg)];};};for "_i" from 0 to count(kguyfx select 0)-1 do{private["_05b"];_05b=(kguyfx select 0)select _i;if(alive _05b)then{_0tc=0;_04e set[count _04e,parseText(_05b call _0vg)];};};private["_0wg"];_0wg=[];for "_i" from 0 to(kg8ncv-count(_04e))do{_0wg set[count _0wg,_0r];};_04e=_0wg+_04e;_0ug ctrlSetStructuredText(composeText _04e);_0ug ctrlShow true;};kgftho={if(kgqqa5)exitWith{};kgqqa5=true;kgin4h=false;private["_0a","_0uf","_03g","_0se","_0xg","_08c","_0yg","_0zg","_01g","_02g","_04g","_05g","_07g"];_0se=_this select 0;_0xg=_this select 1;_08c=_this select 2;_0yg=_this select 3;_0zg=_this select 4;_01g=_this select 5;_02g=_this select 6;disableSerialization;_0a=uiNamespace getVariable "KingOfHill_PlayerHUD";_0uf=_0a displayCtrl kg3rnx;_03g=_0a displayCtrl kgq2xm;_0uf ctrlShow true;_0uf ctrlSetFade 0;_0uf ctrlCommit 0;(_0a displayCtrl kgm189)ctrlSetText _0se;_03g progressSetPosition 0;_04g=diag_tickTime;_05g=diag_tickTime+_08c;_06g=((vehicle player)!=player);_07g="AinvPknlMstpSnonWnonDnon_medic_1";waitUntil{_03g progressSetPosition((diag_tickTime-_04g)/_08c);if(vehicle player==player)then{if((animationState player!=_07g)&&!kgin4h)then{kg1jf6=player;publicVariable "kg1jf6";player switchMove _07g;player playMoveNow _07g;};};(diag_tickTime>=_05g)||!alive player||kgin4h||_0yg call _0zg};if(vehicle player==player)then{player playActionNow "stop";}else{player switchMove(animationState player);player playActionNow(animationState player);if(!_06g)then{player action["eject",(vehicle player)];};};kgqqa5=false;if(!alive player||kgin4h||_0yg call _0zg)then{_0yg call _01g;(_0a displayCtrl kgm189)ctrlSetText "终止";_03g progressSetPosition 0;}else{if(typeName _0xg==typeName{})then{_0xg=_0yg call _0xg;};(_0a displayCtrl kgm189)ctrlSetText _0xg;_0yg call _02g;};sleep 1;if(!kgqqa5)then{_0uf ctrlSetFade 1;_0uf ctrlCommit 0.5;waitUntil{ctrlCommitted _0uf};if(!kgqqa5)then{_0uf ctrlShow false;_0uf ctrlSetFade 0;_0uf ctrlCommit 0;};};};kgdocz={private["_0me","_08g","_09g"];if(typeName(_this)==typeName([]))then{_0me=_this select 0;_08g=_this select 1;_09g=if(isNil{_this select 2})then{false}else{_this select 2};}else{_0me=_this;_08g=1;_09g=false;};if!(_0me in[blufor,opfor,independent])exitWith{str(_0me)};format["<img image='A3\ui_f\data\map\diary\icons\player%1_ca.paa'%5/><%2 color='%3'>%4</%2>",(switch(_0me)do{case blufor:{"West"};case opfor:{"East"};case independent:{"Guer"};}),(if(_09g)then{"font"}else{"t"}),(switch(_0me)do{case blufor:{"#2266bb"};case opfor:{"#aa0000"};case independent:{"#22aa22"};}),localize format["STR_KOH_Gen_Team%1%2",_0me,(switch(_08g)do{case 2:{"_2"};case 3:{"_3"};default{""};})],(if(_09g)then{" height='16'"}else{""})]};kg91jl={copyToClipboard _this;hint parseText format["Copied to clipboard<br/><t color='#8888ff' underline='true'>%1</t><br/><br/>now you can press Alt+Tab and paste it into your browser",_this];};kgivqa={_0ah=["v2","v3","v4","v5","v6","v7","v8","v9","v9+","v9++","v9.1","v9.2","v9.3","v9.4","v9.5"];player createDiarySubject["Changelog",format["%1 Changes (%2)",toString[215],_0ah select(count(_0ah)-1)]];_0bh="<font color=""#aaaaff"">[%1]</font>";_0na=format[_0bh,localize "STR_KOH_Diary_ChangelogNew"];_0ch=format[_0bh,localize "STR_KOH_Diary_ChangelogChanged"];_0dh=format[_0bh,localize "STR_KOH_Diary_ChangelogFixed"];{player createDiaryRecord["Changelog",[format[localize "STR_KOH_Diary_ChangelogEntry",_x],format["<font size='20' color='#cccccc'>%1</font><br/>%2",format[localize "STR_KOH_Diary_ChangelogEntry",_x],format[localize format["STR_KOH_Diary_Changelog_%1",_x],_0na,_0ch,_0dh]]]];}forEach _0ah;};kgumf6={private["_0se","_0lb","_0eh","_08c"];_0se=_this select 0;_0lb=_this select 1;_0eh=_this select 2;_08c=_this select 3;kgffos=diag_tickTime+_08c;kgljn7 cutRsc["KingOfHill_Notification","PLAIN",0.000001];private["_0p","_0pg"];disableSerialization;_0p=(uiNamespace getVariable "KingOfHill_Notification")displayCtrl kgx8zm;_0p ctrlSetStructuredText parseText format["<br/><t size='2' color='%1'>%2</t><br/>%3<br/> ",(if(_0eh)then{"#5555ff"}else{"#ee0000"}),_0se,_0lb];_0pg=(ctrlPosition _0p);_0pg set[3,ctrlTextHeight _0p];_0p ctrlSetPosition _0pg;_0p ctrlCommit 0;};kg3xqw={kgffos=0;kgljn7 cutFadeOut 0;};