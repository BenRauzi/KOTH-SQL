/*
	ArmA 3 King of Hill
	Code written by Sa-Matra
	Using this code without Sa-Matra's direct permission is forbidden
	
	Special build for Gamed.de
	
	Build ETYKMBSIGDHGNALL
*/
#define kg8yw8		150
#define kgzmcs		150
#define kgn571		10
#define kgpe3g		40
#include "defines.hpp"
kg6ieb={kgu8dw serverCommand "#shutdown";};kg1t5r={_01q=diag_tickTime;if((kgo2zz>0)&&(diag_tickTime>kgo2zz))then{kgo2zz=0;publicVariable "kgnine";if(!isDedicated)then{(owner player)publicVariableClient "kgnine";};};if(diag_tickTime>kgqwt4)then{if(count(kgqx55)>0)then{_02q=kgqx55 select 0 select 0;if(!isDedicated||{if((_x select 0)!=_02q)exitWith{1}}count kgqx55==1)then{kg5pax=kgqx55;publicVariable "kg5pax";if(isServer&&!isDedicated)then{(owner player)publicVariableClient "kg5pax";};}else{kg5pax=kgqx55;_02q publicVariableClient "kg5pax";};kgqx55=[];};kgqwt4=0;};switch(kgqyg5)do{case kgze3i:{if(!isNil{kg5km7})then{if(serverTime>(kg5km7+3))then{profileNamespace setVariable["koth_game_started",false];saveProfileNamespace;if(settings_shutdownServerAfterRounds>0)then{profileNamespace setVariable["koth_games_played",(profileNamespace getVariable["koth_games_played",0])+1];format["RESTART DEBUG :: koth_games_played = %1, shutdownServerAfterRounds = %2",profileNamespace getVariable["koth_games_played",0],settings_shutdownServerAfterRounds]call kgkq1c;if(profileNamespace getVariable["koth_games_played",0]>=settings_shutdownServerAfterRounds)then{profileNamespace setVariable["koth_games_played",0];saveProfileNamespace;format["RESTART DEBUG :: EXECUTING #SHUTDOWN"]call kgkq1c;call kg6ieb;};};kgqyg5=kgcx8x;publicVariable "kgqyg5";endMission "END1";};};};case kg27tr:{if!(isNil{kgnx43})then{{_x params["_05q","_07q","_08q","_0ar","_0br","_03q"];if!(missionNamespace getVariable[_03q,false])then{for "_i" from 0 to count(kgubgt)-1 do{_04q=missionNamespace getVariable _05q;_06q=missionNamespace getVariable _07q;if((_04q select _i)==0)then{if(!alive(_06q select _i))then{_04q set[_i,serverTime+_08q];publicVariable _05q;};}else{if(serverTime>=(_04q select _i))then{_09q=[_0ar select _i]+(database_missionsList select kgt51k select 12 select _i select _0br);if((_09q select 1)call kg8ef5)then{if(!isNull(_06q select _i))then{(format["Cleanup, deleting respawnable helicopter wreck: %1",(_06q select _i)])call kgkq1c;(_06q select _i)call kgas69;deleteVehicle(_06q select _i);};_0f=_09q call kg8rpu;_0f setFuel(0.95+random 0.05);_0f setVariable["koh_side",kgubgt select _i,true];_0f setVariable["respawnable_side",kgubgt select _i,true];_0f setVariable["koh_safe",1,true];[_0f,kgubgt select _i]call database_vehicles_initCode;_0f call kg3uuq;call kgzrp9;_06q set[_i,_0f];_04q set[_i,0];publicVariable _07q;publicVariable _05q;}else{kgkfsq set[_i,serverTime+1];};};};};};}forEach[["kgkfsq","kgl5ya",kg8yw8,database_freeHeliList,5,"settings_disableFreeHeli"],["kgel1q","kgv5wv",kgzmcs,database_freeTruckList,6,"settings_disableSpawnTruck"]];};if(diag_tickTime>kghhuz)then{kghhuz=diag_tickTime+kgn571;{_05d=_x;if(!isPlayer _x)then{if(_05d in kgonou&&alive(_05d getVariable["revive_player",objNull]))exitWith{};if(isNil{_05d getVariable "cleanup_at"})then{_05d setVariable["cleanup_at",diag_tickTime+(switch(true)do{case(_05d isKindOf "Man"):{120};default{80};})];if((getPosATL _05d)call kga22h)exitWith{(format["Cleanup, deleting wreck (allDead) right away because it is safe zone: %1",_05d])call kgkq1c;_05d call kgas69;deleteVehicle _05d;};};if(diag_tickTime>(_05d getVariable "cleanup_at"))then{if(!([getPosATL _05d,10]call kgqyc3)||diag_tickTime>((_05d getVariable "cleanup_at")+180))then{(format["Cleanup, deleting wreck (allDead): %1",_05d])call kgkq1c;(format["playersNearby = %1, diag_tickTime > cleanup_at + 180 = %2",([getPosATL _05d,10]call kgqyc3),diag_tickTime>((_05d getVariable "cleanup_at")+180)])call kgkq1c;_05d call kgas69;deleteVehicle _05d;};};};}forEach allDead;{{if(_x call kg8p54)exitWith{};if((getPosATL _x)call kga22h)exitWith{deleteVehicle _x;};if(isNil{_x getVariable "cleanup_start"})then{_x setVariable["cleanup_start",diag_tickTime];};if(diag_tickTime>((_x getVariable "cleanup_start")+(if(local _x)then{20}else{60})))then{if(_x call kg8p54)exitWith{_x setVariable["cleanup_start",nil];};if!([getPosATL _x,10]call kgqyc3)then{deleteVehicle _x;}else{_x setVariable["cleanup_start",diag_tickTime];};};}forEach _x;}forEach[entities "WeaponHolderSimulated",allMissionObjects "GroundWeaponHolder"];if(isNil{kgnx43})exitWith{};{if(alive _x)then{if(_x isKindOf "AllVehicles")then{if(_x getVariable["cleanup_empty_at",0]>0)then{_05d=_x;
#define kg5cdv			60
#define kgvvet	["Quadbike_01_base_F", "I_G_Offroad_01_F", "SUV_01_base_F", "Hatchback_01_base_F", "Kart_01_Base_F"]
if(_05d getVariable["cleanup_delete_at",0]==0)then{_08c=(switch(true)do{case(_05d in kgv5wv):{switch(true)do{case!(canMove _05d):{kg5cdv*2};case(getPosWorld _05d in kgv9bx):{kg5cdv*5};case!([getPosATL _05d,_05d getVariable["respawnable_side",blufor]]call kgjmpk):{kg5cdv*5};default{-1};};};case(_05d in kgl5ya):{switch(true)do{case!(canMove _05d):{kg5cdv*1};case(getPosWorld _05d in kgv9bx):{kg5cdv*3};case!([getPosATL _05d,_05d getVariable["respawnable_side",blufor]]call kgjmpk):{kg5cdv*2};default{-1};};};default{switch(true)do{case({if(_05d isKindOf _x)exitWith{1}}count kgvvet!=0):{if(canMove _05d)then{kg5cdv*10}else{kg5cdv*3};};case({if(_05d isKindOf _x)exitWith{1}}count["Helicopter_Base_F","Tank","Wheeled_APC_F"]!=0):{if(canMove _05d)then{kg5cdv*20}else{kg5cdv*10};};case(getNumber(configFile>>"CfgVehicles">>typeOf _05d>>"vtol")>0):{kg5cdv*30};case(_05d isKindOf "Plane"):{kg5cdv*120};default{if(canMove _05d)then{kg5cdv*10}else{kg5cdv*2};};};};});if(_08c>0)then{_05d setVariable["cleanup_delete_at",serverTime+_08c];}else{_05d setVariable["cleanup_empty_at",0];}};if((_05d getVariable["cleanup_delete_at",0]>0)&&(serverTime>(_05d getVariable["cleanup_delete_at",0])))then{if(!([getPosATL _05d,30]call kgqyc3)||(_05d in kgl5ya))exitWith{if({alive _x}count(crew _05d)==0)then{[_05d,objNull]call kg7gbt;(format["Cleanup, deleting empty\broken vehicle: %1",_05d])call kgkq1c;_05d call kgas69;deleteVehicle _05d;}else{_05d setVariable["cleanup_delete_at",0];};};};};};};}forEach(vehicles);};if(isNil{kgsslk})then{kgsslk=diag_tickTime+kgpe3g;};if(diag_tickTime>kgsslk)then{kgsslk=nil;_0rf=0;_0sf=-1;_0w=[];_0dd=[];for "_i" from 0 to count(kgubgt)-1 do{private["_0x","_0y"];_0x=kgubgt select _i;_0y=0;_0dd set[_i,[]];_0l=(_0dd select _i);{if(side group _x==_0x)then{if((getPosATL _x)call kgfnsu)then{_0y=_0y+1;_0l set[count _0l,_x];};};}forEach playableUnits;_0w set[_i,_0y];};for "_i" from 0 to count(kgubgt)-1 do{private["_04b"];_04b=_0w select _i;if(_04b>_0rf)then{_0sf=_i;};if(_0rf==_04b)then{_0sf=-1;};_0rf=_0rf max _04b;};_0cr=civilian;if(_0sf>=0)then{30 setFog 0.02;_0cr=kgubgt select _0sf;_06=(kguib8 select _0sf);_06=_06+1;kguib8 set[_0sf,_06];kgvsc7=kguib8;publicVariable "kgvsc7";kgs7iq=_0sf;publicVariable "kgs7iq";if(!isDedicated)then{publicVariableServer "kgvsc7";publicVariableServer "kgs7iq";};if(_06==(kg7pk9-2)&&isNil{kgdsor})then{kgdsor=true;kgqi45=true;publicVariable "kgqi45";if(!isDedicated)then{publicVariableServer "kgqi45";};};if(_06>=kg7pk9)then{kg2utt=_0cr;publicVariable "kg2utt";kgqyg5=kgze3i;publicVariable "kgqyg5";kg5km7=serverTime+40;publicVariable "kg5km7";if(!isDedicated)then{publicVariableServer "kg2utt";publicVariableServer "kgqyg5";};if(settings_shutdownServerAfterRounds>0&&(profileNamespace getVariable["koth_games_played",0])+1>=settings_shutdownServerAfterRounds)then{kg8594=true;publicVariable "kg8594";};};for "_i" from 0 to count(kgubgt)-1 do{_0x=kgubgt select _i;{[_x getVariable["koh_owner",0],(if(_0x==_0cr)then{kgnzzt}else{kgti9v})]call kgl3gm;}forEach(_0dd select _i);};};};if(settings_teamBalanceEnabled)then{if(true)then{if(count(kgubgt)>=2)then{if(diag_tickTime>kgjoqi)then{kgjoqi=diag_tickTime+3;_0dr=[];{_0me=_x;_0dr set[_forEachIndex,[{_x==_0me}count(kgzpmd select 3),_0me]];}forEach kgubgt;_0dr sort false;kgc35x=(if((_0dr select 0 select 0)>=settings_teamBalanceMinSidePlayers&&(_0dr select 0 select 0)-(_0dr select 2 select 0)>settings_teamBalanceThreshold)then{_0dr select 2 select 1;}else{sideUnknown;});if(kgc35x!=kgv6hy)then{kgv6hy=kgc35x;publicVariable "kgv6hy";};};};};};};};_0er=diag_tickTime;if(_0er-_01q>0.1)then{format["Long onEachFrame frame detected! Time taken: %1",_0er-_01q]call kgkq1c;};};kgao3s={if(diag_tickTime>kgbdwr+1)then{kgbdwr=diag_tickTime;kg1tcu=call kgvl7z;};kg1tcu};kgvl7z={private["_0rf","_0sf","_0w","_0dd"];_0rf=0;_0sf=-1;_0w=[];_0dd=[];for "_i" from 0 to count(kgubgt)-1 do{private["_0x","_0y"];_0x=kgubgt select _i;_0y=0;_0dd set[_i,[]];_0l=(_0dd select _i);{if(side group _x==_0x)then{if((getPosATL _x)call kgfnsu)then{_0y=_0y+1;_0l set[count _0l,_x];};};}forEach playableUnits;_0w set[_i,_0y];};for "_i" from 0 to count(kgubgt)-1 do{private["_04b"];_04b=_0w select _i;if(_04b>_0rf)then{_0sf=_i;};if(_0rf==_04b)then{_0sf=-1;};_0rf=_0rf max _04b;};(if(_0sf<0)then{civilian}else{kgubgt select _0sf})};kgv45n={if(!isDedicated&&false)exitWith{0 call kg4vz1;};private["_0mb","_0fr","_0pn","_0gr","_0jr","_0lr"];_0mb=configFile;_0fr=(switch(true)do{case(worldName=="Tanoa"):{"MissionChances_Tanoa"};case(worldName=="Altis");default{"MissionChances"};});if({if(count(_x)>0)exitWith{_0mb=_x;1};false;}count[configFile>>"CfgKingOfTheHillSettings">>_0fr,missionConfigFile>>"CfgKingOfTheHillSettings">>_0fr]==0)exitWith{format["No mission chances configs were found in both mission and game configs, starting default mission.",_0mb]call kgkq1c;0 call kg4vz1;};_0pn=[];_0gr=count(database_missionsList);_0hr=profileNamespace getVariable["koh_last_mission_id",-1];for "_i" from 0 to count(_0mb)-1 do{private["_id","_0ir"];_id=floor(getNumber((_0mb select _i)>>"id"));_0ir=floor(getNumber((_0mb select _i)>>"Chance"));if!(settings_noSameTown&&_id==_0hr)then{if(_id>=0&&_id<_0gr&&_0ir>0)then{for "_j" from 1 to _0ir do{_0pn set[count _0pn,_i];};};};};if(count(_0pn)==0)exitWith{format["No applicable missions found in %1, starting default mission.",_0mb]call kgkq1c;0 call kg4vz1;};_0jr=_0mb select(_0pn select floor(random(count(_0pn))));profileNamespace setVariable["koh_last_mission_id",getNumber(_0jr>>"id")];format["Mission ""%1"" was randomly selected.",configName(_0jr)]call kgkq1c;_0pn=[];_0kr=profileNamespace getVariable["koh_last_start_time",""];for "_i" from 0 to count(_0jr>>"TimeChances")-1 do{if!(settings_noSameTime&&configName((_0jr>>"TimeChances")select _i)==_0kr)then{for "_j" from 1 to getNumber((_0jr>>"TimeChances")select _i)do{_0pn set[count _0pn,(_0jr>>"TimeChances")select _i];};};};if(count(_0pn)==0)exitWith{format["No time to select from, using default mission time."]call kgkq1c;getNumber(_0jr>>"id")call kg4vz1;};_0lr=configName(_0pn select floor(random(count _0pn)));kgatxt=switch(_0lr)do{case "Dawn":{[2035,7,6,4,40]};case "Day":{[2035,7,6,10,0]};case "Sunset":{[2035,7,6,18,30]};case "NightBright":{[2035,7,6,23,0]};case "NightDark":{[2035,7,6,1,30]};default{format["Selected time ""%1"" is invalid, using default mission time.",_0lr]call kgkq1c;nil;};};profileNamespace setVariable["koh_last_start_time",_0lr];if(!isNil{kgatxt})then{format["Time ""%1"" (%2) was randomly selected for the mission.",_0lr,kgatxt]call kgkq1c;};if(getNumber(_0jr>>"RandomSpawns")>0)then{kg2dl9=true;format["Random spawns are active",_0lr,kgatxt]call kgkq1c;};saveProfileNamespace;getNumber(_0jr>>"id")call kg4vz1;};kg4vz1={disableRemoteSensors true;kgt51k=_this;private["_0mr"];_0mr=database_missionsList select kgt51k;call(_0mr select 5);if(isNil{kgatxt})then{kgatxt=(_0mr select 6)};setDate kgatxt;setWind[1+random 0.5,0,true];private["_0nr","_0or","_0pr","_0qr","_0rr","_0sr"];_0nr=["\A3\Data_F\Flags\Flag_blue_CO.paa","\A3\Data_F\Flags\Flag_red_CO.paa","\A3\Data_F\Flags\Flag_green_CO.paa"];_0or=[blufor,opfor,independent];_0pr=["passenger_generic01_foldhands","passenger_generic01_leanleft","passenger_generic01_leanright","passenger_mantisrear"];_0qr={sleep 1;private["_0ia","_0xn"];_0ia=getPosATL _this;_0xn=getDir _this;waitUntil{if((getPosATL _this)distance _0ia>0.2)then{_this setPosATL _0ia;_this setDir _0xn;};sleep 1;false};};_0rr=(configFile>>"CfgFaces")select 1;_0sr=[];for "_i" from 0 to count(_0rr)-1 do{_0tr=configName(_0rr select _i);if(_0tr!="Custom"&&(_0tr find "Camo")==-1)then{_0sr set[count _0sr,_0tr]};};kgubgt=[];kghzyg=[];kgz9yy=[];kgmksk=[];kgpli7=[];kgzdcu=[];kghznt=[];kgnv1e=[];kg7jky=[];kgl5ya=[];kgv5wv=[];kgkfsq=[];kgel1q=[];kg1gtz=[];kgdva1=(_0mr select 8);kg7vk8=(_0mr select 9)select 0;kgu85m=(_0mr select 9)select 1;kgmhlg=(_0mr select 9)select 2;kg12rz=(_0mr select 9)select 3;{call{if(_x select 0 isKindOf "Cargo_Tower_base_F"&&settings_disableTowers&&settings_gameType==kgfcbl)exitWith{};private["_0ur","_0y"];_0ur=_x call kgx8i4;[_0ur,false]call kgqjd2;_0y=switch(typeOf _0ur)do{case "Land_Cargo_Tower_V1_No1_F":{0};case "Land_Cargo_Tower_V1_No2_F":{1};case "Land_Cargo_Tower_V1_No3_F":{2};case "Land_Cargo_Tower_V1_No4_F":{3};case "Land_Cargo_Tower_V1_No5_F":{4};case "Land_Cargo_Tower_V1_No6_F":{5};case "Land_Cargo_Tower_V1_No7_F":{6};default{-1};};if(_0y>=0)then{kg1gtz set[_0y,getPosWorld _0ur];};};}forEach(_0mr select 10);if(kg2dl9)then{_0vr=_0mr select 12;_0wr=[];_0xr=[];_08k=[];{_0xr pushBack(_x select 0);_08k pushBack _forEachIndex;_0wr pushBack(_0vr select _forEachIndex);}forEach _0vr;_08k=[_08k,{random 1}]call kgx99f;{_0vr set[_forEachIndex,_0wr select _x];(_0vr select _forEachIndex)set[0,_0xr select _forEachIndex];}forEach _08k;kgwyyr=_0vr;};{private["_0me","_0yr","_0li","_0nm"];_0me=_x select 0;kgubgt set[count kgubgt,_0me];_0yr=[_x select 1 select 0,_x select 1 select 1,database_building_baseCollection,false,true]call kg9ea4;{[_x,false]call kgqjd2;[_x,false]call kgexnd;}forEach _0yr;_0li=(_0yr select 3);_0li setFlagTexture(_0nr select(_0or find _0me));_0li enableSimulation true;[_0li,true]call kgexnd;private["_0zr","_01r","_02r","_03r","_04r","_05r","_06r"];_0zr=_0yr select 9;_01r=_0yr select 13;_02r=_0yr select 5;_03r=createVehicle["C_Nikos",getPos _0zr,[],0,""];_03r allowDamage false;[_03r,false]call kgqjd2;_03r setPosATL(_02r modelToWorld[-0.5,0,0.6]);_03r setDir((getDir _02r)-90+6);_03r switchMove "ChopperLight_CB_idle7lookaround_H";_03r addUniform "U_IG_Guerilla2_1";_03r addWeapon(["hgun_PDW2000_snds_F"]select floor(random 1));_03r addHeadgear "H_Bandanna_gry";if(isDedicated)then{_03r addEventHandler["AnimDone",{(_this select 0)switchMove(_this select 1)}];};_04r=createVehicle["C_Nikos",getPos _01r,[],0,""];_04r allowDamage false;[_04r,false]call kgqjd2;_04r addUniform "U_NikosBody";_04r setPosATL(_01r modelToWorld[0,0,0.3]);_04r setDir((getDir _01r)-90);_04r switchMove(_0pr select floor(random(count _0pr)));_05r=createVehicle["C_Nikos",getPos _0zr,[],0,""];_05r allowDamage false;[_05r,false]call kgqjd2;_05r addUniform "U_OrestesBody";_05r setPosATL(_0zr modelToWorld[0,0,0.3]);_05r setDir((getDir _0zr)-90);_05r switchMove(_0pr select floor(random(count _0pr)));{_0tr=_0sr select floor random count _0sr;_x setFace _0tr;_x setVariable["face",_0tr,true];}forEach[_03r,_04r,_05r];{_x spawn _0qr}forEach[_03r,_04r,_05r];_06r=_0yr select 12;_07r=_0yr select 6;_08r=_0yr select 4;kghzyg set[count kghzyg,[_03r,_04r,_05r,_06r,_07r,_08r]];kgz9yy set[count kgz9yy,ASLtoATL(_x select 1 select 0)];kgnv1e set[count kgnv1e,_x select 3];kg7jky set[count kg7jky,_x select 4];kghznt set[count kghznt,(_0yr select 2)];private "_09r";_09r=[_x select 2 select 0,_x select 2 select 1,database_buildings_repairPointCollection,false,false]call kg8fth;{_x setDir getDir _x;}forEach _09r;kgmksk set[count kgmksk,(_x select 2 select 0)];private "_0hf";_0hf=[0,0,0];for "_i" from 0 to 1 do{_0hf set[_i,((_x select 1 select 0 select _i)+(_x select 2 select 0 select _i))/2];};_0qa=(((kgdva1 select 0)-(_0hf select 0))atan2((kgdva1 select 1)-(_0hf select 1)));_0hf set[0,(_0hf select 0)+sin _0qa*kgrpjf];_0hf set[1,(_0hf select 1)+cos _0qa*kgrpjf];kgpli7 pushBack _0hf;kgzdcu pushBack _0qa;private["_0as","_0bs","_0cs"];_0as=_0yr select 10;_0bs=createVehicle["Land_Photos_V4_F",getPos _0as,[],0,"CAN_COLLIDE"];_0bs enableSimulationGlobal false;_0bs setPosATL(_0as modelToWorld[0.2,0,0.86]);_0bs setDir(getDir _0as-65);[_0bs,0,"i\ee.jpg"]call kg9ynt;_0cs=createVehicle["Land_Photos_V4_F",getPos _0as,[],0,"CAN_COLLIDE"];_0cs enableSimulationGlobal false;_0cs setPosATL(_0as modelToWorld[0.1,0.05,0.8591]);_0cs setDir(getDir _0as-25);[_0cs,0,"i\ee2.jpg"]call kg9ynt;private["_0ds","_0es"];_0ds=(if(settings_disableFreeHeli)then{objNull}else{([database_freeHeliList select _forEachIndex]+(_x select 5))call kg8rpu});_0es=(if(settings_disableSpawnTruck)then{objNull}else{([database_freeTruckList select _forEachIndex]+(_x select 6))call kg8rpu});kgl5ya set[count kgl5ya,_0ds];kgv5wv set[count kgv5wv,_0es];kgkfsq set[count kgkfsq,0];kgel1q set[count kgel1q,0];{if(!isNull _x)then{[_x,_0me]call database_vehicles_initCode;_x setFuel(0.95+random 0.05);_x call kg3uuq;_x setVariable["koh_side",_0me,true];_x setVariable["respawnable_side",_0me,true];_x setVariable["koh_safe",1,true];};}forEach[_0ds,_0es];_0yr spawn{waitUntil{{_0fs=vectorDir _x;_0gs=vectorUp _x;_x setPosATL getPosATL _x;_x setVectorDirAndUp[_0fs,_0gs];}forEach _this;sleep 0.5;time>10};};}forEach(_0mr select 12);kguib8=[0,0,0];kgvsc7=kguib8;kgg41u=_0mr select 13;call kggmuo;call kgdslk;call kgzrp9;call kg3wio;publicVariable "kgubgt";publicVariable "kgvsc7";publicVariable "kghzyg";publicVariable "kgmksk";publicVariable "kgz9yy";publicVariable "kgpli7";publicVariable "kgzdcu";publicVariable "kghznt";publicVariable "kgnv1e";publicVariable "kg7jky";publicVariable "kgl5ya";publicVariable "kgv5wv";publicVariable "kgkfsq";publicVariable "kgel1q";publicVariable "kgg41u";publicVariable "kgatxt";publicVariable "kg1gtz";publicVariable "kgdva1";publicVariable "kg7vk8";publicVariable "kgu85m";publicVariable "kgmhlg";publicVariable "kg12rz";kgqyg5=kg27tr;publicVariable "kgqyg5";if(isServer&&!isDedicated)then{(owner player)publicVariableClient "kgqyg5";};call kgxhpo;if(profileNamespace getVariable["koth_game_started",false])then{profileNamespace setVariable["koth_games_played",0];};profileNamespace setVariable["koth_game_started",true];saveProfileNamespace;};kgl3gm={kgqx55 pushBack _this;if(kgqwt4==0)then{kgqwt4=diag_tickTime+0.5;};};kg7gbt={params["_05b","_0ks","_0ls"];private _0hs=_05b isKindOf "Man";private _0hn=false;private _0kn=false;private _0is=_05b getVariable["koh_side",sideUnknown];private _0js=_05b getVariable["koh_side_original",_0is];if(_05b==_0ks||_0ks in _05b||_05b in _0ks||vehicle _05b==vehicle _0ks)then{_0ks=objNull;_0ls=objNull;};if(isNull _0ls&&!isNull _0ks)then{if(_0ks isKindOf "Man")then{_0ls=_0ks;if(vehicle _0ks!=_0ks)then{if(driver _0ks==_0ks||{isCopilotEnabled vehicle _0ks&&vehicle _0ks turretUnit[0]==_0ks})then{_0hn=true;}else{_0kn=true;};};}else{_0ls=_0ks call kgcsod;};};if(!_0hn&&_0ks==_0ls&&vehicle _0ls!=_0ls)then{_0kn=true;};private _0ms=if(vehicle _0ls!=vehicle _05b&&_0ls getVariable["koh_side",sideUnknown]==_0is&&true)then{_0ls}else{objNull};private _0ap=[];if((_0ks getVariable["koh_laser_assist_at",-1])+30>serverTime)then{_0ap pushBack(_0ks getVariable["koh_laser_assist_by",-1]);};{_0ap pushBackUnique _x;}forEach(_05b getVariable["koh_assists",[]]);if(_0ls getVariable["koh_assisted_by",-1]>0)then{_0ap pushBackUnique(_0ls getVariable["koh_assisted_by",-1]);};private _0ns=objNull;private _0os=objNull;private _0ps=[];{_09c=_x call kgydes;if(!isNull _09c&&_05b!=_09c)then{if(_0is==_0js&&{_09c getVariable["koh_side",sideUnknown]==_0js})exitWith{_0os=_09c;};if(isNull _0ns)then{_0ns=_09c;};if(_09c getVariable["koh_side",sideUnknown]!=_0is)then{_0ps pushBack _09c;};};}forEach _0ap;if(_0hs&&(vehicle _05b==_05b||vehicle _05b==vehicle _0os))then{_0os=objNull;};if(_0ms==_0ls)then{_0ls=objNull;};private _0qs=call{if(!isNull _0ls)exitWith{_0ls};if(!isNull _0ns)exitWith{_0ns};objNull;};private _0rs=_0qs getVariable["koh_side",sideUnknown];private _0ss=call{if(_0qs==_0ls)exitWith{objNull};if(!isNull _0ms)exitWith{_0ms};if(!isNull _0os)exitWith{_0os};objNull;};if(vehicle _0qs!=_0qs&&!isNull vehicle _0qs)then{_0ya=(vehicle _0qs)call kgrgrc;if(_0qs in(_0ya select 0))exitWith{};{if(_forEachIndex>0)then{if(!isNull _x)then{_0ps pushBack _x;};};}forEach _0ya;};private _0ts=[];private _01l=+_0ps+[_0ls,_0ns];
#define kgqglh	60
if(!isNull _0qs)then{{if(alive _x)then{if(_x getVariable["koh_side",sideUnknown]==_0rs)then{if(_0qs distance _x<kgqglh)then{if(_x getVariable["koh_safe",-1]<0)then{if!(_x in _01l)then{_0ts pushBack _x;};};};};};}forEach(kgzpmd select 0);};private _0us=(if(_0hs)then{kg4qaz}else{kgxvv8});private _0vs=(if(_0hs)then{kgsy29}else{kgnpv9});private _0ws=(_05b getVariable["koh_killstreak",0]>=4)&&_0hs;if(!isNull _0qs)then{_0qs setVariable["koh_killstreak",(_0qs getVariable["koh_killstreak",0])+1];if(_0ws)then{[_0qs getVariable["koh_owner",0],kg7ibj,_05b getVariable["koh_killstreak",0]]call kgl3gm;};[_0qs getVariable["koh_owner",0],_0us,(typeOf _05b)]call kgl3gm;};{if(_0ws)then{[_x getVariable["koh_owner",0],kg7ibj,_05b getVariable["koh_killstreak",0]]call kgl3gm;};[_x getVariable["koh_owner",0],_0vs,(typeOf _05b)]call kgl3gm;}forEach((_0ps arrayIntersect _0ps)-[objNull,_0qs,_0ms,_0os]);{[_x getVariable["koh_owner",0],kg1k2k,(typeOf _05b)]call kgl3gm;}forEach _0ts;if(_0hs&&isPlayer _05b&&(!isNull _0qs||!isNull _0ss))then{_09m=!isNull _0ss;_0jn=if(_09m)then{_0ss}else{_0qs};_0en=if(_09m)then{_0ss==_0ms}else{_0qs==_0ls};kg87s8=[_09m,_0jn,[vehicle _0jn,group _0jn,typeOf vehicle _0jn,getPlayerUID(_0jn)call kgn1kn,currentWeapon _0jn,_0jn distance _05b,_0jn getVariable["koh_level",0],_0jn getVariable["koh_side",sideUnknown]],_0en,_0hn,_0kn];(owner _05b)publicVariableClient "kg87s8";};if(_0hs&&!isNull _0qs&&_0qs==_0ls&&_0ks==_0ls&&!_0hn)then{kgkgb4=_05b;(owner _0qs)publicVariableClient "kgkgb4";};if(_05b getVariable["koh_killstreak",0]>0)then{_05b setVariable["koh_killstreak",0];};if(!isNull _0ss)then{_0xs=(_05b getVariable["koh_owner",-1])call kg7aa7;_0ys=(owner _0ss)call kg7aa7;if(_0xs!=""&&_0ys!=""&&_0ys!=_0xs)then{if(_0hs)then{format["Teamkiller report: Player name=%1 uid=%2 was teamkilled by player name=%3 uid=%4 direct=%5 weapon=%6 distance=%7",_0xs call kgn1kn,_0xs,_0ys call kgn1kn,_0ys,_0ss==_0ms,(if(vehicle _0ss!=_0ss&&!_0kn)then{typeOf vehicle _0ss}else{currentWeapon _0ss}),round(_0ss distance _05b)]call kgkq1c;}else{format["Teamkiller report: Vehicle %1 owned by name=%2 uid=%3 was teamkilled by player name=%4 uid=%5 direct=%6 weapon=%7 distance=%8",typeOf _05b,_0xs call kgn1kn,_0xs,_0ys call kgn1kn,_0ys,_0ss==_0ms,(if(vehicle _0ss!=_0ss&&!_0kn)then{typeOf vehicle _0ss}else{currentWeapon _0ss}),round(_0ss distance _05b)]call kgkq1c;};};};if(!isDedicated)then{diag_log "-----------------------------------------";diag_log format["_05b = %1 (%2)",_05b,typeOf _05b];diag_log format["_0ls = %1",_0ls];diag_log format["_0ms = %1",_0ms];diag_log format["_0ns = %1",_0ns];diag_log format["_0os = %1",_0os];diag_log format["_0ps = %1",_0ps];diag_log format["koh_assists = %1",_05b getVariable "koh_assists"];_0zs=[_05b,_0qs,_0ss,_0hn,_0kn];{if(_x isEqualType objNull)then{_0zs set[_forEachIndex,format["%1: %2",typeOf _x,_x]];};}forEach _0zs;diag_log str _0zs;diag_log "_this = ";_0zs=_this;{if(_x isEqualType objNull)then{_0zs set[_forEachIndex,format["%1: %2",typeOf _x,_x]];};}forEach _0zs;diag_log str _0zs;};};kgr8xy={private["_0f","_0jn","_01s","_02s","_0nn","_0ap","_03s","_04s","_05s","_06s","_involved","_08s","_07s"];_0f=_this select 0;_0jn=_this select 1;_01s=objNull;_02s=objNull;_0nn=false;_0hn=false;_0ap=[];_03s=-1;_04s=[];_05s=[];_06s=[];if(!isNull(_0jn)&&(_0jn!=_0f))then{if((_0jn isKindOf "Man"))then{_01s=_0jn;if(vehicle _0jn!=_0jn)then{_0hn=true;};}else{_01s=_0jn call kgcsod;};};_07s=_0f getVariable["koh_side",civilian];_08s=_01s getVariable["koh_side",_07s];_0ap=+(_0f getVariable["koh_assists",[]]);_03s=_0jn getVariable["koh_laser_assist_at",-1];if(serverTime>_03s&&(_03s+30>serverTime))then{_09s=_0jn getVariable["koh_laser_assist_by",-1];if!(_09s in _0ap)then{_0ap pushBack _09s;};};_0at=_01s getVariable["koh_assisted_by",0];if(_0at>0&&!(_0at in _0ap))then{_0ap pushBack _0at;};{if(_x>0)then{_09c=_x call kgydes;if(_09c getVariable["koh_side",civilian]!=_07s&&_09c!=_01s)then{_04s set[count _04s,_09c];};};}forEach _0ap;if(_07s==_08s)then{_02s=_01s;_05s=[];};if((_01s==_02s||isNull(_01s)||(_01s==_0f)||(vehicle _01s==_0f))&&count(_04s)>0)then{_01s=_04s select(count(_04s)-1);_04s=_04s-[_01s];_08s=_01s getVariable["koh_side",_07s];_0nn=true;};if(_01s==_02s)then{_01s=objNull;};if(isPlayer(_0f)&&(vehicle _0f==_0f))then{_05n=(if(!isNull(_02s))then{_02s}else{_01s});if(!isNull(_05n)&&_05n!=_0f)then{_name=getPlayerUID(_05n)call kgn1kn;kg87s8=[_0jn,_05n,vehicle _05n,typeOf vehicle _05n,_05n getVariable["koh_side",civilian],_05n getVariable["koh_level",0],currentWeapon _05n,_name,_0f distance _05n,!isNull(_02s),_0nn,_0hn];(owner _0f)publicVariableClient "kg87s8";};};if(vehicle _01s!=_01s&&!isNull(_01s))then{_0ya=(vehicle _01s)call kgrgrc;if!(_01s in(_0ya select 0))then{for "_i" from 1 to count(_0ya)-1 do{if(!isNull(_0ya select _i))then{if((_0ya select _i)!=_01s&&!((_0ya select _i)in _04s))then{_05s set[count _05s,(_0ya select _i)];};};};};};_04s=_04s+_05s;
#define kgqglh	60
if(!isNull(_01s))then{{if(_x getVariable["koh_side",civilian]==_08s)then{if(_01s distance _x<kgqglh)then{if(!(_x in _04s)&&_01s!=_x)then{_06s set[count _06s,_x];};};};}forEach(playableUnits);};_0us=kg4qaz;_0vs=kgsy29;if!(_0f isKindOf "Man")then{_0us=kgxvv8;_0vs=kgnpv9;};if(!isNull(_01s))then{[_01s getVariable["koh_owner",0],_0us,(typeOf _0f)]call kgl3gm;if(_0us==kg4qaz)then{if(side group _01s!=call kgao3s)then{if((getPosATL _01s)call kgfnsu)then{[_01s getVariable["koh_owner",0],kgkm55]call kgl3gm;};};};};{[_x getVariable["koh_owner",0],_0vs,(typeOf _0f)]call kgl3gm;}forEach _04s;{[_x getVariable["koh_owner",0],kg1k2k]call kgl3gm;}forEach _06s;};kgwnlo={private["_09c","_0ec","_0bt","_0zj","_0me","_0ct","_0dt","_0xn","_0et","_0ft"];_09c=_this select 0;_0ec=_this select 1;_0bt=_this select 2;_0zj=_this select 3;_0me=(side group _09c);_0g=_09c getVariable["koh_level",0];if(!alive _09c||!(_0me in kgubgt))exitWith{objNull};_0ct=kgdva1;_0dt=getPosASL(kghznt select(kgubgt find _0me));_0xn=((_0ct select 0)-(_0dt select 0))atan2((_0ct select 1)-(_0dt select 1));_0et=+_0ct;_0et set[0,(_0et select 0)-(sin _0xn)*1000*5];_0et set[1,(_0et select 1)-(cos _0xn)*1000*5];_0ft=30;while{_0ft>0}do{_0ft=_0ft-1;if([_0et,_0me,5000]call kgk6qw)exitWith{};_0et set[0,(_0et select 0)-(sin _0xn)*1000];_0et set[1,(_0et select 1)-(cos _0xn)*1000];};if(_0ft<=0)exitWith{objNull;};private["_0f","_0gt"];_0f=createVehicle[_0ec,[-10000,random 20000,5000],[],0,"FLY"];_0f call kg74om;[_0f,_0me,_0g]call database_vehicles_initCode;_0f engineOn true;_0f setFuel(0.95+random 0.05);_0f call kg3uuq;call kgzrp9;_0f setVariable["cleanup_empty_at",diag_tickTime];_0f setVariable["koh_owner",owner _09c,true];_0f setVariable["koh_side",side group _09c,true];_0f setVariable["koh_side_original",side group _09c,true];_0f setVariable["koh_uid",getPlayerUID _09c];_0f setVariable["koh_price",_0zj];_0f setVariable["koh_bought_at",serverTime];_0et set[2,500+random 500];_0gt=800;_0xn=_0xn-10+random 20;_0sa=[_0gt*(sin _0xn)/5,_0gt*(cos _0xn)/5,10];_0f setPosATL _0et;_0f setDir _0xn;_0f setVelocity _0sa;kgfsn3=[_0f,_0sa];publicVariable "kgfsn3";_0f};kgk6qw={private["_pos","_0me","_09b","_0ba"];_pos=_this select 0;_0me=_this select 1;_09b=_this select 2;_pos set[2,0];_0ba=false;{if(alive _x&&(_x isKindOf "Plane"||_x isKindOf "Tank")&&(_x getVariable["koh_side",civilian]!=_0me))then{_0ab=getPosASL _x;_0ab set[2,0];if(_pos distance _0ab<_09b)exitWith{_0ba=true;};};if(_0ba)exitWith{1};}count vehicles!=1};kg4jex={private["_09c","_0ec","_0bt","_0zj","_0me"];_09c=_this select 0;_0ec=_this select 1;_0bt=_this select 2;_0zj=_this select 3;_0me=(side group _09c);_0g=_09c getVariable["koh_level",0];if(!alive _09c||!(_0me in kgubgt))exitWith{objNull};private["_0vr","_0ht","_0it"];_0vr=(switch(_0bt)do{case 0:{kg7jky};case 1:{kgnv1e};});_0ht=[+(_0vr select(kgubgt find _0me)),{_09c distance(_this select 0)}]call kgx99f;_0it=-1;for "_i" from 0 to count(_0ht)-1 do{private["_0jt"];_0jt=nearestObjects[_0ht select _i select 0,["AllVehicles"],if(_0ec isKindOf "VTOL_01_base_F")then{30}else{9}];if({alive _x}count _0jt==0)exitWith{{if(!alive _x)then{deleteVehicle _x}}forEach _0jt;{deleteVehicle _x}forEach nearestObjects[_0ht select _i select 0,["CraterLong"],20];_0it=_i;};};if(_0it==-1)exitWith{objNull};private["_0nm","_0f"];_0nm=_0ht select _0it;_0f=[_0ec,(_0nm select 0),(_0nm select 1)]call kg8rpu;[_0f,_0me,_0g]call database_vehicles_initCode;_0f setFuel(0.95+random 0.05);_0f lock true;_0f call kg3uuq;call kgzrp9;_0f setVariable["cleanup_empty_at",diag_tickTime];_0f setVariable["koh_owner",owner _09c,true];_0f setVariable["koh_side",side group _09c,true];_0f setVariable["koh_side_original",side group _09c,true];_0f setVariable["koh_safe",1,true];_0f setVariable["koh_uid",getPlayerUID _09c];_0f setVariable["koh_price",_0zj];_0f setVariable["koh_bought_at",serverTime];_0f};kg8ef5={private["_0jt"];_0jt=nearestObjects[_this,["AllVehicles"],8];if({alive _x}count _0jt==0)exitWith{{if(!alive _x)then{deleteVehicle _x}}forEach _0jt;{deleteVehicle _x}forEach nearestObjects[_this,["CraterLong"],20];true};false};kg8rpu={private["_0ec","_0pg","_0qa","_0f"];_0ec=_this select 0;_0pg=_this select 1;_0qa=_this select 2;_0f=createVehicle[_0ec,_0pg,[],0,"CAN_COLLIDE"];_0f setPosATL _0pg;_0f setDir _0qa;_0f setVectorUp(surfaceNormal _0pg);_0f call kg74om;_0f;};kg74om={if(settings_disableVehicleThermals&&settings_gameType==kgfcbl)then{_this disableTIEquipment true;};clearWeaponCargoGlobal _this;clearMagazineCargoGlobal _this;clearItemCargoGlobal _this;clearBackpackCargoGlobal _this;_this;};kgxdme={private["_0kt"];_0kt=[];{if(_this==_x getVariable["koh_owner",0])then{if((kgzpmd select 1)find _this==-1)then{_x lock false;if!(local _x)then{_0kt set[count _0kt,_x];};};};}forEach vehicles;if(count(_0kt)>0)then{kgv1le=_0kt;publicVariable "kgv1le";};};kgj6uh={private["_0lt","_0mt","_0nt"];if(settings_gameType==kgfcbl)then{_0lt=({if(isArray(_x))exitWith{_0ba=[];{if(typeName _x==typeName 0)then{if!(_x in _0ba)then{_0ba pushBack _x;};};}forEach getArray(_x);_0ba;};}forEach[configFile>>"CfgKingOfTheHillSettings">>"DisabledPerks",missionConfigFile>>"CfgKingOfTheHillSettings">>"DisabledPerks"]);_0mt=({if(isArray(_x))exitWith{_0ba=[];{if(typeName _x==typeName "")then{if!(_x in _0ba)then{_0ba pushBack _x;};};}forEach getArray(_x);_0ba;};}forEach[configFile>>"CfgKingOfTheHillSettings">>"DisabledWeapons",missionConfigFile>>"CfgKingOfTheHillSettings">>"DisabledWeapons"]);_0nt=({if(isClass(_x))exitWith{_0ba=[[],[]];for "_i" from 0 to count(_x)-1 do{if!(configName(_x select _i)in(_0ba select 0))then{(_0ba select 0)pushBack configName(_x select _i);(_0ba select 1)pushBack floor(getNumber(_x select _i));};};_0ba;};}forEach[configFile>>"CfgKingOfTheHillSettings">>"VehiclesAvailability",missionConfigFile>>"CfgKingOfTheHillSettings">>"VehiclesAvailability"]);};if(isNil{_0lt})then{_0lt=[];};if(isNil{_0mt})then{_0mt=[];};if(isNil{_0nt})then{_0nt=[[],[]];};kggu5h=_0lt;publicVariable "kggu5h";kg26ki=_0mt;publicVariable "kg26ki";kgqmj3=_0nt;publicVariable "kgqmj3";if(!isDedicated)then{publicVariableServer "kggu5h";publicVariableServer "kg26ki";publicVariableServer "kgqmj3";};_0lb=({if(isText(_x>>"RulesDialog">>"RulesText">>"English"))exitWith{getText(_x>>"RulesDialog">>"RulesText">>"English");};}forEach[configFile>>"CfgKingOfTheHillSettings",missionConfigFile>>"CfgKingOfTheHillSettings"]);if(isNil{_0lb})then{_0lb="";};settings_RulesText=_0lb;publicVariable "settings_RulesText";private["_0mb","_0hp","_0mm","_0sl"];_0mb=configFile;if({if(isClass(_x))exitWith{_0mb=_x;1};}count[configFile>>"CfgKingOfTheHillSettings",missionConfigFile>>"CfgKingOfTheHillSettings"]==0)then{};
#define kghlju		0
#define kgq9rw		1
#define kgai35		2
#define kg9qzd		3
#define kgez3u		4
#define kgkx7k	5
{_0hp=_0mb>>(_x select 0);_0mm=format["settings_%1",_x select 0];_0sl=(if(switch(_x select 1)do{case kghlju:{isNumber(_0hp)||getNumber(_0hp)!=0};case kgq9rw:{isText(_0hp)};case kgai35:{isNumber(_0hp)};case kg9qzd:{isText(_0hp)};case kgez3u:{isArray(_0hp)};case kgkx7k:{isArray(_0hp)};})then{switch(_x select 1)do{case kghlju:{getNumber(_0hp)};case kgq9rw:{getText(_0hp)};case kgai35:{getNumber(_0hp)==1};case kg9qzd:{getText(_0hp)};case kgez3u:{getArray(_0hp)};case kgkx7k:{getArray(_0hp)};}}else{_x select 2});missionNamespace setVariable[_0mm,switch(_x select 1)do{case kgkx7k:{compileFinal str _0sl};case kg9qzd:{compileFinal _0sl};default{_0sl};}];publicVariable _0mm;}forEach[["setTimeMultiplier",kghlju,1],["teamBalanceEnabled",kgai35,true],["teamBalanceThreshold",kghlju,4],["teamBalanceMinSidePlayers",kghlju,10],["teamBalanceStartsAfterTime",kghlju,300],["noSameTown",kgai35,false],["noSameTime",kgai35,false],["disableVehicleThermals",kgai35,false],["disableKilledByWeaponAndDistance",kgai35,false],["shutdownServerAfterRounds",kghlju,0],["jetBuyDelay",kghlju,(60*10)],["disableTowers",kgai35,false],["viewDistanceLimitFoot",kghlju,3000],["viewDistanceLimitGround",kghlju,3000],["viewDistanceLimitHelis",kghlju,3000],["viewDistanceLimitJets",kghlju,5000],["disableFreeHeli",kgai35,false],["disableSpawnTruck",kgai35,false],["trustedUIDs",kgkx7k,["76561198218047556"]]];{_0mm=format["settings_%1",_x];_0sl=missionNamespace getVariable[_0mm,0];_0sl=round(_0sl/500)*500;if(_0sl<1000)then{_0sl=1000};if(_0sl>10000)then{_0sl=10000};if(missionNamespace getVariable[_0mm,0]!=_0sl)then{missionNamespace setVariable[_0mm,_0sl];publicVariable _0mm;};}forEach["viewDistanceLimitFoot","viewDistanceLimitGround","viewDistanceLimitHelis","viewDistanceLimitJets"];kgu8dw=getText(_0mb>>"shutdownServerPassword");};kgdkn9={500+(_this*500)+((_this-5)max 0)*500+((_this-10)max 0)*250+((_this-20)max 0)*250+((_this-30)max 0)*500};kgl6yn={private["_0il"];_0il=0;for "_i" from 1 to _this do{_0il=_0il+(_i call kgdkn9);};_0il};